import{u as e,h as t,r as s,j as a,m as i,A as n,aQ as r,aR as l,aS as o,H as c}from"./vendor-0A5iGyAR.js";import{f as d,c as u,r as m,a as x,Q as h,b as g,d as b}from"./QuizError-k0MqqUNg.js";import{u as p}from"./index-D5Tt7n0c.js";import{u as f}from"./useQuizSounds-CP2U6g0S.js";const y=["ðŸ…°ï¸","ðŸ…±ï¸","ðŸ‡¨","ðŸ‡©"],j=({show:e})=>e?a.jsx("div",{className:"absolute inset-0 pointer-events-none z-40 flex items-center justify-center",children:a.jsx("span",{role:"img","aria-label":"confetti",className:"text-5xl animate-bounce",children:"ðŸŽ‰"})}):null,v=({timeLeft:e,total:t})=>a.jsxs("div",{className:"sticky top-0 z-20 mb-4",children:[a.jsx(i.div,{className:"h-3 w-full bg-gray-200 rounded overflow-hidden",children:a.jsx(i.div,{className:"h-3 rounded "+(e<10?"bg-red-500":e<t/3?"bg-yellow-400":"bg-blue-500"),initial:{width:"100%"},animate:{width:e/t*100+"%"},transition:{duration:.5}})}),a.jsx("div",{className:"flex justify-between text-xs mt-1",children:a.jsxs("span",{children:["Time Left: ",a.jsxs("b",{children:[Math.floor(e/60),":",(e%60).toString().padStart(2,"0")]})]})})]}),N=()=>{const N=t(),w=e(),{user:k}=p(),{contextualBack:C,navigateToHome:S}=(()=>{const a=e(),i=t(),n=s.useCallback(()=>{const e=i.pathname;return e.includes("/custom-quiz")&&!e.includes("setup")?"/custom-quiz-setup":e.includes("/quick-quiz")?"/quiz":e.includes("/timed-test")&&!e.includes("setup")?"/timed-test-setup":e.includes("/results")||e.includes("/custom-quiz-setup")||e.includes("/timed-test-setup")?"/quiz":e.includes("/quiz")||e.includes("/profile")||e.includes("/learn")||e.includes("/leaderboard")?"/":e.includes("/auth/")?"/auth/welcome":"/"},[i.pathname]);return{contextualBack:s.useCallback(()=>{const e=n();a(e)},[a,n]),navigateToQuiz:s.useCallback(()=>{a("/quiz")},[a]),navigateToHome:s.useCallback(()=>{a("/")},[a]),navigateWithState:s.useCallback((e,t=null)=>{a(e,{state:t})},[a]),getContextualBackRoute:n,currentPath:i.pathname}})(),I=N.state,[q,z]=s.useState([]),[_,Q]=s.useState(!0),[O,E]=s.useState(null),[R,T]=s.useState(0),[F,H]=s.useState(null),[G,M]=s.useState(!1),[U,$]=s.useState(!1),[B,L]=s.useState([]),[A,P]=s.useState(null),[W,D]=s.useState(!1),[J,K]=s.useState("timed"===I?.timing?60:null),[V,X]=s.useState(()=>"true"===localStorage.getItem("quizMuted")),[Y,Z]=s.useState(!1),[ee,te]=s.useState(0),se=s.useRef(),{playCorrect:ae,playWrong:ie,playTimesUp:ne,playComplete:re}=f(V);s.useEffect(()=>{if(!I)return E({code:"NO_CONFIG",message:"No quiz configuration found."}),void Q(!1);Q(!0);const e=I.topicId||I.systemId||I.subjectId||"mixed";d({userId:k.id,categoryId:e,questionCount:I.questionCount,difficulty:I.difficulty}).then(async e=>{if(!e||e.length<I.questionCount)return E({code:"INSUFFICIENT_QUESTIONS_ERROR",message:`Not enough questions available for your selection. Only ${e?.length||0} found.`}),z(e||[]),void Q(!1);z(e),Q(!1);const t=await u({userId:k.id,sessionType:"custom",totalQuestions:e.length,settings:I});P(t.id)}).catch(e=>{E({code:"FETCH_ERROR",message:e?.message||"Failed to load questions."}),Q(!1)})},[I,k,w]),s.useEffect(()=>{if("timed"===I?.timing&&!W&&!_)return K(60),se.current&&clearInterval(se.current),se.current=setInterval(()=>{K(e=>e<=1?(clearInterval(se.current),$(!0),M(!0),0):e-1)},1e3),()=>clearInterval(se.current)},[R,W,_,I]),s.useEffect(()=>{G&&!U&&(F===q[R]?.correct_option_id?(Z(!0),setTimeout(()=>Z(!1),1200),ae()):ie()),U&&ne()},[G,U,F,q,R,ae,ie,ne]),s.useEffect(()=>{if(W){re();let e=0;const t=B.filter(e=>e.isCorrect).length,s=setInterval(()=>{e++,te(Math.min(e,t)),e>=t&&clearInterval(s)},20);return()=>clearInterval(s)}},[W,B,re]);const le=s.useCallback(e=>{G||(H(e),M(!0),$(!1),m({sessionId:A,userId:k.id,questionId:q[R].id,selectedOptionId:e,isCorrect:e===q[R].correct_option_id,timeSpent:"timed"===I?.timing?60-J:null,responseOrder:R+1}).catch(e=>{console.error("Failed to record quiz response:",e)}))},[G,q,R,A,k,I,J]),oe=s.useCallback(()=>{if(L(e=>[...e,{questionId:q[R].id,selectedOption:F,isCorrect:F===q[R].correct_option_id,timedOut:U,timeSpent:"timed"===I?.timing?60-J:null}]),H(null),M(!1),$(!1),R<q.length-1)T(e=>e+1);else if(D(!0),A){const e=B.filter(e=>e.isCorrect).length,t=B.reduce((e,t)=>e+(t.timeSpent||0),0);x(A,{correctAnswers:e,totalTimeSeconds:t,pointsEarned:10*e,completed:!0}).catch(e=>{console.error("Failed to complete Custom Quiz session:",e)})}},[R,q,F,U,I,J,A,B]);if(B.filter(e=>e.isCorrect).length,_)return a.jsx(h,{});if(O)return a.jsx(g,{error:O,onRetry:()=>window.location.reload()});if(!q.length)return a.jsx(g,{error:{code:"NO_QUESTIONS",message:"No questions found for this quiz."},onRetry:()=>window.location.reload()});if(W)return a.jsxs(i.div,{className:"max-w-xl mx-auto mt-8 bg-white/80 dark:bg-slate-900/80 rounded-3xl shadow-xl p-8 flex flex-col items-center",initial:{opacity:0,y:24},animate:{opacity:1,y:0},children:[a.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Quiz Complete!"}),a.jsxs("div",{className:"mb-4 text-3xl font-extrabold text-green-600",children:[a.jsx(n,{children:a.jsx(i.span,{initial:{scale:.7},animate:{scale:1},transition:{type:"spring",stiffness:300},children:ee},ee)}),a.jsxs("span",{className:"text-gray-700 font-normal text-xl",children:[" / ",q.length]})]}),a.jsx("button",{className:"mt-4 px-6 py-2 rounded-xl bg-cyan-600 text-white font-semibold hover:bg-cyan-700 transition",onClick:()=>window.location.reload(),children:"Restart"}),a.jsx("button",{className:"mt-4 px-6 py-2 rounded-xl bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition",onClick:()=>w("/quiz-tab"),"aria-label":"Go to Home",children:"Home"})]});const ce=q[R]||{};return a.jsx("div",{className:"min-h-screen flex flex-col items-center justify-start bg-gradient-to-br from-cyan-100 via-blue-100 to-slate-200 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 py-8",children:a.jsxs("div",{className:"w-full max-w-xl mx-auto relative",children:["timed"===I?.timing&&a.jsx(v,{timeLeft:J,total:60}),a.jsx(b,{current:R+1,total:q.length,secondsLeft:"timed"===I?.timing?J:null}),a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("button",{onClick:C,className:"p-2 rounded-lg hover:bg-white/50 dark:hover:bg-gray-700 transition-colors","aria-label":"Go back to quiz setup",children:a.jsx(r,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"})}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>{X(e=>(localStorage.setItem("quizMuted",!e),!e))},className:"p-2 rounded-lg hover:bg-white/50 dark:hover:bg-gray-700 transition-colors",title:V?"Unmute":"Mute",children:V?a.jsx(l,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"}):a.jsx(o,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"})}),a.jsx("button",{onClick:S,className:"p-2 rounded-lg hover:bg-white/50 dark:hover:bg-gray-700 transition-colors","aria-label":"Go to Home",children:a.jsx(c,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"})})]})]}),a.jsx(n,{mode:"wait",children:ce?a.jsxs(i.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3},className:"relative",children:[a.jsx(j,{show:Y}),a.jsxs("div",{className:"mb-2 font-semibold",children:["Question ",R+1," / ",q.length]}),a.jsx("div",{className:"mb-4 text-lg font-medium",children:ce.question_text}),a.jsx("div",{className:"space-y-2 mb-4",children:ce.options&&ce.options.map((e,t)=>a.jsxs(i.button,{className:`w-full flex items-center gap-3 text-left p-3 rounded-xl border transition-all font-semibold text-base focus:outline-none focus:ring-2 focus:ring-cyan-400 ${F===e.id?e.id===ce.correct_option_id?"bg-green-100 border-green-400 scale-105":"bg-red-100 border-red-400 shake":"border-gray-200 hover:bg-cyan-50"} ${G?"pointer-events-none":""}`,disabled:G,onClick:()=>le(e.id),"aria-pressed":F===e.id,tabIndex:0,"aria-label":`Option ${t+1}: ${e.text}`,children:[a.jsx("span",{className:"text-2xl",children:y[t]||"ðŸ”˜"}),a.jsx("span",{children:e.text})]},e.id))}),a.jsx(n,{children:G&&a.jsxs(i.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,y:-12},className:"mb-2",children:[F===ce.correct_option_id?a.jsx("div",{className:"text-green-700 font-semibold",children:"Correct!"}):a.jsxs("div",{className:"text-red-700 font-semibold",children:["Incorrect. Correct answer: ",a.jsx("b",{children:ce.options.find(e=>e.id===ce.correct_option_id)?.text})]}),ce.explanation&&a.jsx("div",{className:"mt-2 text-sm text-gray-600 bg-gray-50 rounded p-2",children:ce.explanation}),a.jsx("button",{className:"mt-4 w-full bg-cyan-600 text-white py-2 rounded-xl font-semibold text-lg shadow-lg hover:bg-cyan-700 transition",onClick:oe,"data-next-btn":!0,"aria-label":"Next Question",children:R<q.length-1?"Next Question":"Finish Quiz"})]})})]},ce.id):!_&&a.jsxs("div",{className:"text-center text-gray-600 dark:text-gray-400 py-10",children:[a.jsx("p",{children:"No question available to display. Please try again or select a different category."}),a.jsx("button",{onClick:()=>w(-1),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Go Back"})]})})]})})};export{N as default};
