import{b as e,u as t,r as s,j as r,q as a}from"./vendor-react-RdnW0GgT.js";import{u as i}from"./index-BEAApk6D.js";import{Q as l}from"./questionService-gpVGUodb.js";import{h as n}from"./vendor-DpG1waVL.js";const o=()=>{const o=e(),d=t(),{user:c}=i(),{categoryId:u,categoryName:x,questionCount:g}=o.state||{categoryId:null,categoryName:null,questionCount:10},[b,m]=s.useState([]),[h,y]=s.useState(0),[p,f]=s.useState(null),[j,N]=s.useState(!1),[v,k]=s.useState(0),[w,Q]=s.useState(!0),[S,q]=s.useState(null),[z,C]=s.useState(null);s.useEffect(()=>{(async()=>{if(!c)return q("Please log in to take a quiz."),void Q(!1);if(!u)return q("No category selected."),void Q(!1);try{const e=await l.createQuizSession(c.id,u,g);C(e);const t=await l.fetchQuestions(u,g);m(t)}catch(e){q(e.message||"Error loading quiz. Please try again."),console.error("Quiz loading error:",e)}finally{Q(!1)}})()},[u,g,c]);if(!c)return r.jsxs("div",{className:"flex flex-col items-center justify-center h-screen",children:[r.jsx("p",{className:"text-lg text-gray-600 mb-4",children:"Please log in to take a quiz."}),r.jsx("button",{onClick:()=>d("/auth/login"),className:"bg-blue-600 text-white px-6 py-2 rounded-lg",children:"Log In"})]});if(w)return r.jsx("div",{className:"flex justify-center items-center h-screen",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});if(S)return r.jsxs("div",{className:"flex flex-col items-center justify-center h-screen",children:[r.jsx("p",{className:"text-lg text-red-600 mb-4",children:S}),r.jsx("button",{onClick:()=>d("/categories"),className:"bg-blue-600 text-white px-6 py-2 rounded-lg",children:"Back to Categories"})]});if(0===b.length)return r.jsxs("div",{className:"flex flex-col items-center justify-center h-screen",children:[r.jsx("p",{className:"text-lg text-gray-600 mb-4",children:"No questions found for this category."}),r.jsx("button",{onClick:()=>d("/categories"),className:"bg-blue-600 text-white px-6 py-2 rounded-lg",children:"Try Another Category"})]});const _=b[h],E=(h+1)/b.length*100;return r.jsx("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 p-3",children:r.jsxs("div",{className:"max-w-2xl mx-auto",children:[r.jsxs("div",{className:"flex items-center justify-between mb-3",children:[r.jsx("button",{onClick:()=>d(-1),className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700",children:r.jsx(a,{size:20})}),r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-base font-bold",children:x||"Quiz"}),r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Question ",h+1," / ",b.length]})]}),r.jsxs("div",{className:"text-right",children:[r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Score"}),r.jsxs("div",{className:"text-base font-bold",children:[v,"/",b.length]})]})]}),r.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mb-3 dark:bg-gray-700",children:r.jsx("div",{className:"bg-purple-600 h-2 rounded-full",style:{width:`${E}%`}})}),r.jsxs(n.div,{initial:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},transition:{duration:.5},className:"bg-white dark:bg-gray-800 p-4 rounded-xl shadow-md",children:[r.jsx("h2",{className:"text-lg font-semibold mb-3",children:_.question_text}),r.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:_.question_tags.map(e=>r.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-medium px-2 py-0.5 rounded-full dark:bg-blue-900 dark:text-blue-300",children:e.tags.name},e.tag_id))}),r.jsx("div",{className:"space-y-2",children:_.options&&_.options.map(e=>r.jsx("button",{onClick:()=>{return t=e.id,void(j||f(t));var t},disabled:j,className:`w-full text-left p-3 rounded-lg border-2 transition-all\n                  ${p===e.id?"border-blue-500 bg-blue-100 dark:bg-blue-900":"border-gray-300 dark:border-gray-600"}\n                  ${j&&e.id===_.correct_option_id?"bg-green-200 dark:bg-green-800 border-green-500":""}\n                  ${j&&p===e.id&&e.id!==_.correct_option_id?"bg-red-200 dark:bg-red-800 border-red-500":""}\n                  ${j?"cursor-not-allowed":"hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:e.text},e.id))}),j&&_.explanation&&r.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-3 p-3 rounded-lg bg-gray-100 dark:bg-gray-700",children:[r.jsx("h3",{className:"font-bold mb-2 text-sm",children:"Explanation"}),r.jsx("p",{className:"text-sm",children:_.explanation})]}),r.jsx("div",{className:"mt-4 text-center",children:j?r.jsx("button",{onClick:async()=>{if(h<b.length-1)y(h+1),f(null),N(!1);else{const t=p===b[h].correct_option_id?v+1:v;try{await l.completeQuizSession(z.id,c.id,t),d("/results",{state:{score:t,totalQuestions:b.length,sessionId:z.id}})}catch(e){console.error("Error completing quiz:",e),d("/results",{state:{score:t,totalQuestions:b.length}})}}},className:"w-full bg-blue-600 text-white font-bold py-2.5 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:h<b.length-1?"Next Question":"Finish Quiz"}):r.jsx("button",{onClick:async()=>{if(null===p||!z)return;const e=b[h],t=p===e.correct_option_id;t&&k(v+1),N(!0);try{await l.recordQuizResponse(z.id,e.id,p,t,h+1),await l.updateUserQuestionHistory(c.id,e.id,p,t)}catch(s){console.error("Error recording answer:",s)}},disabled:null===p,className:"w-full bg-green-600 text-white font-bold py-2.5 px-4 rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed",children:"Submit Answer"})})]},h)]})})};export{o as default};
