import{h as e,u as t,r as s,j as a,m as i,A as n,aQ as r,aR as o,aS as l,H as c}from"./vendor-0A5iGyAR.js";import{f as d,c as u,r as m,a as x,Q as g,b as h,d as f}from"./QuizError-D3C0RHlX.js";import{u as b}from"./index-tZRWtBsW.js";import{u as p}from"./useQuizSounds-CP2U6g0S.js";const y=["ðŸ…°ï¸","ðŸ…±ï¸","ðŸ‡¨","ðŸ‡©"],j=({show:e})=>e?a.jsx("div",{className:"absolute inset-0 pointer-events-none z-40 flex items-center justify-center",children:a.jsx("span",{role:"img","aria-label":"confetti",className:"text-5xl animate-bounce",children:"ðŸŽ‰"})}):null,v=({timeLeft:e,total:t})=>a.jsxs("div",{className:"sticky top-0 z-20 mb-4",children:[a.jsx(i.div,{className:"h-3 w-full bg-gray-200 rounded overflow-hidden",children:a.jsx(i.div,{className:"h-3 rounded "+(e<10?"bg-red-500":e<t/3?"bg-yellow-400":"bg-blue-500"),initial:{width:"100%"},animate:{width:e/t*100+"%"},transition:{duration:.5}})}),a.jsx("div",{className:"flex justify-between text-xs mt-1",children:a.jsxs("span",{children:["Time Left: ",a.jsxs("b",{children:[Math.floor(e/60),":",(e%60).toString().padStart(2,"0")]})]})})]}),N=()=>{const N=e(),w=t(),{user:S}=b(),I=N.state,[C,k]=s.useState([]),[q,_]=s.useState(!0),[z,Q]=s.useState(null),[O,E]=s.useState(0),[R,T]=s.useState(null),[F,G]=s.useState(!1),[H,M]=s.useState(!1),[U,$]=s.useState([]),[L,A]=s.useState(null),[P,B]=s.useState(!1),[W,D]=s.useState("timed"===I?.timing?60:null),[J,K]=s.useState(()=>"true"===localStorage.getItem("quizMuted")),[V,X]=s.useState(!1),[Y,Z]=s.useState(0),ee=s.useRef(),{playCorrect:te,playWrong:se,playTimesUp:ae,playComplete:ie}=p(J);s.useEffect(()=>{if(!I)return Q({code:"NO_CONFIG",message:"No quiz configuration found."}),void _(!1);_(!0);const e=I.topicId||I.systemId||I.subjectId||"mixed";d({userId:S.id,categoryId:e,questionCount:I.questionCount,difficulty:I.difficulty}).then(async e=>{if(!e||e.length<I.questionCount)return Q({code:"INSUFFICIENT_QUESTIONS_ERROR",message:`Not enough questions available for your selection. Only ${e?.length||0} found.`}),k(e||[]),void _(!1);k(e),_(!1);const t=await u({userId:S.id,sessionType:"custom",totalQuestions:e.length,settings:I});A(t.id)}).catch(e=>{Q({code:"FETCH_ERROR",message:e?.message||"Failed to load questions."}),_(!1)})},[I,S,w]),s.useEffect(()=>{if("timed"===I?.timing&&!P&&!q)return D(60),ee.current&&clearInterval(ee.current),ee.current=setInterval(()=>{D(e=>e<=1?(clearInterval(ee.current),M(!0),G(!0),0):e-1)},1e3),()=>clearInterval(ee.current)},[O,P,q,I]),s.useEffect(()=>{F&&!H&&(R===C[O]?.correct_option_id?(X(!0),setTimeout(()=>X(!1),1200),te()):se()),H&&ae()},[F,H,R,C,O,te,se,ae]),s.useEffect(()=>{if(P){ie();let e=0;const t=U.filter(e=>e.isCorrect).length,s=setInterval(()=>{e++,Z(Math.min(e,t)),e>=t&&clearInterval(s)},20);return()=>clearInterval(s)}},[P,U,ie]);const ne=s.useCallback(e=>{F||(T(e),G(!0),M(!1),m({sessionId:L,userId:S.id,questionId:C[O].id,selectedOptionId:e,isCorrect:e===C[O].correct_option_id,timeSpent:"timed"===I?.timing?60-W:null,responseOrder:O+1}).catch(e=>{console.error("Failed to record quiz response:",e)}))},[F,C,O,L,S,I,W]),re=s.useCallback(()=>{if($(e=>[...e,{questionId:C[O].id,selectedOption:R,isCorrect:R===C[O].correct_option_id,timedOut:H,timeSpent:"timed"===I?.timing?60-W:null}]),T(null),G(!1),M(!1),O<C.length-1)E(e=>e+1);else if(B(!0),L){const e=U.filter(e=>e.isCorrect).length,t=U.reduce((e,t)=>e+(t.timeSpent||0),0);x(L,{correctAnswers:e,totalTimeSeconds:t,pointsEarned:10*e,completed:!0}).catch(e=>{console.error("Failed to complete Custom Quiz session:",e)})}},[O,C,R,H,I,W,L,U]);if(U.filter(e=>e.isCorrect).length,q)return a.jsx(g,{});if(z)return a.jsx(h,{error:z,onRetry:()=>window.location.reload()});if(!C.length)return a.jsx(h,{error:{code:"NO_QUESTIONS",message:"No questions found for this quiz."},onRetry:()=>window.location.reload()});if(P)return a.jsxs(i.div,{className:"max-w-xl mx-auto mt-8 bg-white/80 dark:bg-slate-900/80 rounded-3xl shadow-xl p-8 flex flex-col items-center",initial:{opacity:0,y:24},animate:{opacity:1,y:0},children:[a.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Quiz Complete!"}),a.jsxs("div",{className:"mb-4 text-3xl font-extrabold text-green-600",children:[a.jsx(n,{children:a.jsx(i.span,{initial:{scale:.7},animate:{scale:1},transition:{type:"spring",stiffness:300},children:Y},Y)}),a.jsxs("span",{className:"text-gray-700 font-normal text-xl",children:[" / ",C.length]})]}),a.jsx("button",{className:"mt-4 px-6 py-2 rounded-xl bg-cyan-600 text-white font-semibold hover:bg-cyan-700 transition",onClick:()=>window.location.reload(),children:"Restart"}),a.jsx("button",{className:"mt-4 px-6 py-2 rounded-xl bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300 transition",onClick:()=>w("/quiz-tab"),"aria-label":"Go to Home",children:"Home"})]});const oe=C[O]||{};return a.jsx("div",{className:"min-h-screen flex flex-col items-center justify-start bg-gradient-to-br from-cyan-100 via-blue-100 to-slate-200 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 py-8",children:a.jsxs("div",{className:"w-full max-w-xl mx-auto relative",children:["timed"===I?.timing&&a.jsx(v,{timeLeft:W,total:60}),a.jsx(f,{current:O+1,total:C.length,secondsLeft:"timed"===I?.timing?W:null}),a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("button",{onClick:()=>w(-1),className:"p-2 rounded-lg hover:bg-white/50 dark:hover:bg-gray-700 transition-colors","aria-label":"Go to Previous Question",children:a.jsx(r,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"})}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>{K(e=>(localStorage.setItem("quizMuted",!e),!e))},className:"p-2 rounded-lg hover:bg-white/50 dark:hover:bg-gray-700 transition-colors",title:J?"Unmute":"Mute",children:J?a.jsx(o,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"}):a.jsx(l,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"})}),a.jsx("button",{onClick:()=>w("/quiz-tab"),className:"p-2 rounded-lg hover:bg-white/50 dark:hover:bg-gray-700 transition-colors","aria-label":"Go to Home",children:a.jsx(c,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"})})]})]}),a.jsx(n,{mode:"wait",children:oe?a.jsxs(i.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3},className:"relative",children:[a.jsx(j,{show:V}),a.jsxs("div",{className:"mb-2 font-semibold",children:["Question ",O+1," / ",C.length]}),a.jsx("div",{className:"mb-4 text-lg font-medium",children:oe.question_text}),a.jsx("div",{className:"space-y-2 mb-4",children:oe.options&&oe.options.map((e,t)=>a.jsxs(i.button,{className:`w-full flex items-center gap-3 text-left p-3 rounded-xl border transition-all font-semibold text-base focus:outline-none focus:ring-2 focus:ring-cyan-400 ${R===e.id?e.id===oe.correct_option_id?"bg-green-100 border-green-400 scale-105":"bg-red-100 border-red-400 shake":"border-gray-200 hover:bg-cyan-50"} ${F?"pointer-events-none":""}`,disabled:F,onClick:()=>ne(e.id),"aria-pressed":R===e.id,tabIndex:0,"aria-label":`Option ${t+1}: ${e.text}`,children:[a.jsx("span",{className:"text-2xl",children:y[t]||"ðŸ”˜"}),a.jsx("span",{children:e.text})]},e.id))}),a.jsx(n,{children:F&&a.jsxs(i.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,y:-12},className:"mb-2",children:[R===oe.correct_option_id?a.jsx("div",{className:"text-green-700 font-semibold",children:"Correct!"}):a.jsxs("div",{className:"text-red-700 font-semibold",children:["Incorrect. Correct answer: ",a.jsx("b",{children:oe.options.find(e=>e.id===oe.correct_option_id)?.text})]}),oe.explanation&&a.jsx("div",{className:"mt-2 text-sm text-gray-600 bg-gray-50 rounded p-2",children:oe.explanation}),a.jsx("button",{className:"mt-4 w-full bg-cyan-600 text-white py-2 rounded-xl font-semibold text-lg shadow-lg hover:bg-cyan-700 transition",onClick:re,"data-next-btn":!0,"aria-label":"Next Question",children:O<C.length-1?"Next Question":"Finish Quiz"})]})})]},oe.id):!q&&a.jsxs("div",{className:"text-center text-gray-600 dark:text-gray-400 py-10",children:[a.jsx("p",{children:"No question available to display. Please try again or select a different category."}),a.jsx("button",{onClick:()=>w(-1),className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Go Back"})]})})]})})};export{N as default};
