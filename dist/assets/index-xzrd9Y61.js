const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Home-CgUZRXGU.js","assets/vendor-ClUtAdzf.js","assets/useViewTransitions-Cjn25MEf.js","assets/QuizTab-WIgWyCIv.js","assets/Profile-BdNOnr53.js","assets/chatService-CS2gkoLv.js","assets/Leaderboard-SseSZeHy.js","assets/Learn-C50f5w3i.js","assets/QuickQuiz-DojiPJyt.js","assets/questionFetchService-3iNm6DhZ.js","assets/QuizError-iqaESagW.js","assets/responseService-CzKTm3IW.js","assets/TimedTest-BlAqdRQ6.js","assets/TimedTestSetup-2KrRBu4A.js","assets/Results-CkRKTyYP.js","assets/CustomQuiz-BqPLfMjN.js","assets/BlockTest-0Lkx25yq.js","assets/Login-BoMXxjYB.js","assets/formValidation-CSmGDhQf.js","assets/SignUp-DSsV_Wuo.js","assets/ForgotPassword-CgCm4m93.js","assets/Welcome-Cgchj79g.js","assets/Privacy-Bbb3IZ8v.js","assets/Terms-bVyy87sF.js","assets/Chat-vI_7uRLk.js"])))=>i.map(i=>d[i]);
import{Q as e,p as t,c as r,r as s,j as a,T as n,R as i,H as o,L as l,D as c,C as d,a as u,B as h,u as m,m as g,M as x,b as p,d as f,S as y,e as b,U as w,f as j,g as N,h as v,G as k,X as _,i as E,k as C,l as T,N as R,A as S,I,n as A,_ as O,o as P,q as z,s as q,t as U,v as D}from"./vendor-ClUtAdzf.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const L=new e({defaultOptions:{queries:{staleTime:12e4,gcTime:6e5,refetchOnWindowFocus:!0,refetchOnReconnect:!0,refetchOnMount:"always",retry:(e,t)=>!(t?.status>=400&&t?.status<500)&&e<3,retryDelay:e=>Math.min(1e3*2**e,3e4)},mutations:{retry:1,onError:e=>{console.error("Mutation error:",e)}}}}),F={persistClient:async e=>{try{const t=JSON.stringify({clientState:e,timestamp:Date.now()});localStorage.setItem("REACT_QUERY_OFFLINE_CACHE",t)}catch(t){console.warn("Failed to persist query cache:",t)}},restoreClient:async()=>{try{const e=localStorage.getItem("REACT_QUERY_OFFLINE_CACHE");if(!e)return;const{clientState:t,timestamp:r}=JSON.parse(e),s=864e5;return Date.now()-r>s?void localStorage.removeItem("REACT_QUERY_OFFLINE_CACHE"):t}catch(e){return console.warn("Failed to restore query cache:",e),void localStorage.removeItem("REACT_QUERY_OFFLINE_CACHE")}},removeClient:async()=>{localStorage.removeItem("REACT_QUERY_OFFLINE_CACHE")}};t({queryClient:L,persister:F,maxAge:864e5,buster:"1.0.0"});const $="https://bkuowoowlmwranfoliea.supabase.co",Q="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJrdW93b293bG13cmFuZm9saWVhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyMDA4NTQsImV4cCI6MjA2NTc3Njg1NH0.lNbEJRUEOl3nVtRPNqKsJu4w031DHae5bjOxZIFlSpI",H=r($,Q,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),M=Boolean(Q),W=async()=>{try{console.log("🔍 [Supabase] Testing database connection..."),console.log("🌐 [Supabase] URL:",$),console.log("🔑 [Supabase] Key present:",!0);const{data:e,error:t}=await H.from("tags").select("id, name").limit(1);return t?(console.error("❌ [Supabase] Connection test failed:",t),{success:!1,message:`Database error: ${t.message}`,details:t}):(console.log("✅ [Supabase] Connection test successful"),console.log("📊 [Supabase] Sample data:",e),{success:!0,message:"Database connection successful",data:e})}catch(e){return console.error("💥 [Supabase] Connection test exception:",e),{success:!1,message:`Connection failed: ${e.message}`,details:e}}};class G extends Error{constructor(e){super(e),this.name="AuthError"}}const V={signUp:async(e,t,r)=>{const{data:s,error:a}=await H.auth.signUp({email:e,password:t,options:{data:{full_name:r}}});if(a)throw new G(a.message);if(s.user&&s.user.identities&&0===s.user.identities.length)throw new G("This email is already in use. Please try another email.");return s},signIn:async(e,t)=>{const{data:r,error:s}=await H.auth.signInWithPassword({email:e,password:t});if(s)throw new G(s.message);return r},signOut:async()=>{const{error:e}=await H.auth.signOut();if(e)throw new G(e.message)},resetPassword:async e=>{const{error:t}=await H.auth.resetPasswordForEmail(e,{redirectTo:`${window.location.origin}/reset-password`});if(t)throw new G(t.message)},updateProfile:async e=>{const{data:{user:t}}=await H.auth.getUser();if(!t)throw new G("User not authenticated");const{data:r,error:s}=await H.from("profiles").update(e).eq("id",t.id).select().single();if(s)throw new G(s.message);return r}},B={ERROR:0,WARN:1,INFO:2,DEBUG:3,TRACE:4},Y={ERROR:"#ff4444",WARN:"#ffaa00",INFO:"#4488ff",DEBUG:"#888888",TRACE:"#cccccc"};const J=new class{constructor(){this.level=B.INFO,this.context={}}setContext(e){this.context={...this.context,...e}}clearContext(){this.context={}}_shouldLog(e){return B[e]<=this.level}_formatMessage(e,t,r={}){return{timestamp:(new Date).toISOString(),level:e,message:t,context:{...this.context,...r},userAgent:navigator?.userAgent||"unknown",url:window?.location?.href||"unknown"}}_logToConsole(e,t){const{timestamp:r,message:s,context:a}=t,n=Y[e],i=`%c[${e}] ${r.split("T")[1].split(".")[0]}`;Object.keys(a).length>0?(console.groupCollapsed(i,`color: ${n}; font-weight: bold`,s),console.table(a),console.groupEnd()):console.log(i,`color: ${n}; font-weight: bold`,s)}_logToRemote(e){e.level}error(e,t={},r=null){if(!this._shouldLog("ERROR"))return;const s={...t,...r&&{errorName:r.name,errorMessage:r.message,errorStack:r.stack}},a=this._formatMessage("ERROR",e,s);return this._logToConsole("ERROR",a),this._logToRemote(a),a}warn(e,t={}){if(!this._shouldLog("WARN"))return;const r=this._formatMessage("WARN",e,t);return this._logToConsole("WARN",r),r}info(e,t={}){if(!this._shouldLog("INFO"))return;const r=this._formatMessage("INFO",e,t);return this._logToConsole("INFO",r),r}debug(e,t={}){if(!this._shouldLog("DEBUG"))return;const r=this._formatMessage("DEBUG",e,t);return this._logToConsole("DEBUG",r),r}trace(e,t={}){if(!this._shouldLog("TRACE"))return;const r=this._formatMessage("TRACE",e,t);return this._logToConsole("TRACE",r),r}success(e,t={}){if(!this._shouldLog("INFO"))return;const r=this._formatMessage("INFO",e,t),{timestamp:s,context:a}=r,n=`%c[SUCCESS] ${s.split("T")[1].split(".")[0]}`;return Object.keys(a).length>0?(console.groupCollapsed(n,"color: #22c55e; font-weight: bold",e),console.table(a),console.groupEnd()):console.log(n,"color: #22c55e; font-weight: bold",e),r}time(e){return console.time(e),e}timeEnd(e,t={}){console.timeEnd(e),this.debug(`Performance: ${e} completed`,t)}quizStart(e,t,r={}){this.setContext({userId:t,quizType:e}),this.info("Quiz session started",{quizType:e,userId:t,config:r,sessionId:r.sessionId})}quizError(e,t,r={}){this.error(`Quiz operation failed: ${e}`,r,t)}questionFetch(e,t,r=null){const s={operation:e,questionsFound:t?.length||0,...r&&{duration:r}};0===t?.length?this.warn("No questions found for fetch operation",s):this.info("Questions fetched successfully",s)}userHistoryUpdate(e,t,r=null){t?this.debug("User history updated",{questionId:e}):this.warn("User history update failed",{questionId:e},r)}fallbackUsed(e,t,r){this.warn("Fallback strategy used",{primaryOperation:e,fallbackOperation:t,reason:r})}},K=async(e,t)=>{const r=performance.now(),s=`${e}_${Date.now()}_${Math.random().toString(36).substr(2,5)}`;J.time(s);try{const e=await t(),a=performance.now()-r;return J.timeEnd(s,{duration:`${a.toFixed(2)}ms`}),e}catch(a){const e=performance.now()-r;throw J.timeEnd(s,{duration:`${e.toFixed(2)}ms`,error:!0}),a}},Z={FAST:5e3,STANDARD:1e4,CRITICAL:2e4},X={maxAttempts:3,baseDelay:1e3,maxDelay:1e4,backoffFactor:2},ee=async(e,t={})=>{const{timeout:r=Z.STANDARD,retries:s=X.maxAttempts,retryDelay:a=X.baseDelay,queryType:n="unknown",fallback:i=null,onRetry:o=null}=t;let l=null;for(let d=1;d<=s;d++)try{const t=new Promise((e,t)=>{setTimeout(()=>{t(new Error(`Query timeout after ${r}ms (${n})`))},r)}),s=await Promise.race([e(),t]);return d>1&&J.success(`Query succeeded on attempt ${d}`,{queryType:n,attempt:d,timeout:r}),s}catch(c){if(l=c,J.warn(`Query attempt ${d} failed`,{queryType:n,attempt:d,error:c.message,timeout:r,willRetry:d<s}),d>=s)break;const e=Math.min(a*Math.pow(X.backoffFactor,d-1),X.maxDelay);o&&o(d,c,e),await new Promise(t=>setTimeout(t,e))}if(J.error(`Query failed after ${s} attempts`,{queryType:n,timeout:r,finalError:l?.message},l),null!==i)return J.info("Using fallback value for failed query",{queryType:n,fallback:i}),i;throw l},te=(e,t={})=>ee(e,{timeout:Z.STANDARD,retries:3,queryType:"user-data",fallback:null,...t}),re=(e,t={})=>ee(e,{timeout:Z.FAST,retries:3,queryType:"categories",fallback:[],...t}),se=s.createContext(),ae=()=>{const e=s.useContext(se);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},ne=({children:e})=>{const[t,r]=s.useState(null),[n,i]=s.useState(!0),[o,l]=s.useState(null);s.useEffect(()=>{if(!M)return J.warn("Supabase not configured. Authentication will not work."),void i(!1);i(!0);const{data:{subscription:e}}=H.auth.onAuthStateChange(async(e,t)=>{const s=setTimeout(()=>{J.warn(`[AuthContext:onAuthStateChange] Auth state change handler timeout for event: ${e}`),i(!1)},15e3);try{J.debug(`[AuthContext:onAuthStateChange] Auth event: ${e}`,{session:t});const s=t?.user;r(s??null),s?await d(s.id,e):l(null)}catch(a){J.error("[AuthContext:onAuthStateChange] Error in auth state change handler:",{error:a,event:e,message:a.message}),l(null)}finally{clearTimeout(s),i(!1)}});return c(),()=>{e?.unsubscribe()}},[]);const c=async()=>{try{J.debug("[AuthContext:getInitialSession] Triggering initial session check..."),await H.auth.getSession()}catch(e){J.error("[AuthContext:getInitialSession] Error triggering initial session check:",{error:e,message:e.message}),i(!1)}},d=async(e,t="unknown")=>{if(!e)return J.error(`[AuthContext:fetchUserProfile] Called with undefined/null userId (context: ${t})`),null;J.debug(`[AuthContext:fetchUserProfile] Fetching user profile for ID: ${e} (context: ${t})`);try{return await((e,t={})=>ee(e,{timeout:Z.CRITICAL,retries:2,queryType:"authentication",...t}))(async()=>{const{data:r,error:s}=await H.from("profiles").select("*").eq("id",e).maybeSingle();if(s){if(J.error(`[AuthContext:fetchUserProfile] Error in initial profile fetch (context: ${t}):`,{error:s,userId:e,code:s.code,message:s.message,details:s.details}),"PGRST116"===s.code)return J.warn(`[AuthContext:fetchUserProfile] No profile found for user (context: ${t})`,{userId:e}),l(null),null;if("PGRST301"===s.code||"42501"===s.code)return J.error(`[AuthContext:fetchUserProfile] Permission denied (RLS) (context: ${t})`,{userId:e}),l(null),null;throw s}if(r)return J.info(`[AuthContext:fetchUserProfile] Profile found and loaded (context: ${t}):`,{userId:e,profileId:r.id,email:r.email,hasCountry:!!r.countries,hasGrade:!!r.achievement_grades}),l(r),r;{J.warn(`[AuthContext:fetchUserProfile] No profile found for user, attempting to create... (context: ${t})`,e),await u(e),J.debug(`[AuthContext:fetchUserProfile] Retrying profile fetch after creation... (context: ${t})`);const r=H.from("profiles").select("*").eq("id",e).maybeSingle(),{data:s,error:a}=await Promise.race([r,new Promise((e,t)=>setTimeout(()=>t(new Error("Retry fetch timeout")),1e4))]);if(a){if(J.error(`[AuthContext:fetchUserProfile] Error in retry profile fetch (context: ${t}):`,{error:a,userId:e,code:a.code,message:a.message}),"PGRST116"===a.code)return J.warn(`[AuthContext:fetchUserProfile] No profile found for user after creation (context: ${t})`,{userId:e}),l(null),null;if("PGRST301"===a.code||"42501"===a.code)return J.error(`[AuthContext:fetchUserProfile] Permission denied (RLS) after creation (context: ${t})`,{userId:e}),l(null),null;throw a}return s?J.info(`[AuthContext:fetchUserProfile] Profile successfully created and fetched (context: ${t}):`,{userId:e,profileId:s.id,email:s.email}):J.error(`[AuthContext:fetchUserProfile] Profile creation appeared to succeed but profile still not found (context: ${t})`),l(s),s}},{queryType:`profile-${t}`,fallback:null})}catch(r){const s=JSON.stringify(r,Object.getOwnPropertyNames(r));return J.error(`[AuthContext:fetchUserProfile] Unexpected error (context: ${t}): errorString=${s}`,{error:r,userId:e,errorType:r.constructor?.name,message:r.message,code:r.code,details:r.details,stack:r.stack}),l(null),null}},u=async e=>{J.debug("[AuthContext] Creating user profile for:",e);try{J.debug("[AuthContext] Getting authenticated user data...");const{data:{user:t},error:r}=await H.auth.getUser();if(r)throw J.error("[AuthContext] Error getting authenticated user:",r),r;if(!t){const e=new Error("No authenticated user found");throw J.error("[AuthContext] No authenticated user:",e),e}J.info("[AuthContext] Authenticated user found:",{id:t.id,email:t.email,metadata:t.user_metadata}),J.debug("[AuthContext] Attempting to manually trigger profile creation...");const{error:s}=await H.rpc("create_user_profile_manual",{user_id:e,user_email:t.email,user_display_name:t.user_metadata?.display_name||t.email?.split("@")[0]||"User",user_full_name:t.user_metadata?.full_name||t.email?.split("@")[0]||"User"});if(s){J.warn("[AuthContext] RPC function not available, trying direct insert with SECURITY DEFINER context..."),J.debug("[AuthContext] Getting default country...");const{data:r,error:s}=await H.from("countries").select("id").eq("code","US").maybeSingle();s&&J.error("[AuthContext] Error getting default country:",s),J.debug("[AuthContext] Default country found:",r);const a={id:e,email:t.email,display_name:t.user_metadata?.display_name||t.email?.split("@")[0]||"User",full_name:t.user_metadata?.full_name||t.email?.split("@")[0]||"User",country_id:r?.id||null,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};J.debug("[AuthContext] Attempting profile insert with data:",a);const{error:n}=await H.from("profiles").insert(a);if(n)throw J.error("[AuthContext] Profile insert failed:",{error:n,code:n.code,message:n.message,details:n.details,hint:n.hint,profileData:a}),n}J.info("[AuthContext] Profile created successfully for user:",e)}catch(t){throw J.error("[AuthContext] Critical error creating profile:",{error:t,userId:e,errorType:t.constructor.name,code:t.code,message:t.message,details:t.details,hint:t.hint,stack:t.stack}),t}},h={user:t,profile:o,loading:n,signOut:async()=>{await V.signOut(),r(null),l(null)},refreshProfile:()=>t?.id?d(t.id,"refreshProfile"):J.warn("[AuthContext:refreshProfile] Tried to refresh profile with missing user id"),isConfigured:M};return a.jsx(se.Provider,{value:h,children:e})},ie=s.createContext(),oe=({children:e})=>{const[t,r]=s.useState(()=>{const e=localStorage.getItem("theme");return e?"dark"===e:window.matchMedia("(prefers-color-scheme: dark)").matches});s.useEffect(()=>{localStorage.setItem("theme",t?"dark":"light"),t?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[t]);return a.jsx(ie.Provider,{value:{isDarkMode:t,toggleTheme:()=>{r(e=>!e)}},children:e})};class le extends s.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null,retryCount:0}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t}),J.error("Uncaught error in React component",{errorInfo:t,componentStack:t.componentStack,errorBoundary:this.props.fallbackComponent||"default",retryCount:this.state.retryCount},e)}handleRetry=()=>{this.setState(e=>({hasError:!1,error:null,errorInfo:null,retryCount:e.retryCount+1}))};handleGoHome=()=>{window.location.href="/"};render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback(this.state.error,this.handleRetry);const{error:e}=this.state,t=e?.message?.includes("fetch")||e?.message?.includes("Network"),r=e?.message?.includes("auth")||e?.message?.includes("unauthorized");return a.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-50 dark:bg-gray-900 p-4",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 p-8 rounded-xl shadow-lg text-center max-w-md w-full",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx(n,{className:"w-16 h-16 text-red-500 mx-auto mb-4"}),a.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:t?"Connection Error":r?"Authentication Error":"Something went wrong"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:t?"Please check your internet connection and try again.":r?"Please sign in again to continue.":"We encountered an unexpected error. Please try again."}),!1]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[a.jsxs("button",{onClick:this.handleRetry,className:"flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors",disabled:this.state.retryCount>=3,children:[a.jsx(i,{className:"w-4 h-4"}),this.state.retryCount>=3?"Max retries reached":"Try Again"]}),a.jsxs("button",{onClick:this.handleGoHome,className:"flex items-center justify-center gap-2 bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:[a.jsx(o,{className:"w-4 h-4"}),"Go Home"]})]})]})})}return this.props.children}}class ce extends s.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t}),J.error("Authentication error boundary triggered",{errorInfo:t,authFlow:this.props.authFlow||"unknown",userAgent:navigator.userAgent},e)}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};handleGoToLogin=()=>{window.location.href="/login"};render(){if(this.state.hasError){const{error:e}=this.state,t=e?.message?.includes("session")||e?.message?.includes("token"),r=e?.message?.includes("fetch")||e?.message?.includes("Network");return a.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 p-4",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 p-8 rounded-xl shadow-xl text-center max-w-md w-full",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx(n,{className:"w-12 h-12 text-orange-500 mx-auto mb-4"}),a.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:t?"Session Expired":r?"Connection Error":"Authentication Error"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:t?"Your session has expired. Please sign in again.":r?"Unable to connect to our servers. Please check your connection.":"We encountered an issue with authentication. Please try again."})]}),a.jsxs("div",{className:"flex flex-col gap-3",children:[!t&&a.jsxs("button",{onClick:this.handleRetry,className:"flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:[a.jsx(i,{className:"w-4 h-4"}),"Try Again"]}),a.jsxs("button",{onClick:this.handleGoToLogin,className:"flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:[a.jsx(l,{className:"w-4 h-4"}),t?"Sign In Again":"Go to Login"]})]})]})})}return this.props.children}}class de extends s.Component{constructor(e){super(e),this.state={hasError:!1,error:null,retryCount:0}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){J.error("Query error boundary triggered",{errorInfo:t,queryType:this.props.queryType||"unknown",retryCount:this.state.retryCount},e)}handleRetry=()=>{this.setState(e=>({hasError:!1,error:null,retryCount:e.retryCount+1})),this.props.onRetry&&this.props.onRetry()};render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback(this.state.error,this.handleRetry);const{error:e}=this.state,t=e?.message?.includes("timeout")||e?.message?.includes("Timeout"),r=e?.message?.includes("fetch")||e?.message?.includes("Network"),s=this.state.retryCount<3;return a.jsx("div",{className:"flex flex-col items-center justify-center p-8 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:a.jsxs("div",{className:"text-center max-w-sm",children:[a.jsxs("div",{className:"mb-4",children:[r?a.jsx(c,{className:"w-12 h-12 text-red-500 mx-auto mb-3"}):a.jsx(d,{className:"w-12 h-12 text-orange-500 mx-auto mb-3"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:t?"Request Timeout":r?"Connection Error":"Data Loading Error"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-4",children:t?"The request took too long to complete.":r?"Unable to connect to the server.":"Failed to load the requested data."})]}),s&&a.jsxs("button",{onClick:this.handleRetry,className:"flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors mx-auto",children:[a.jsx(i,{className:"w-4 h-4"}),"Try Again"]}),!s&&a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Maximum retry attempts reached. Please refresh the page."})]})})}return this.props.children}}class ue extends s.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){this.setState({errorInfo:t}),J.error("Quiz error boundary triggered",{errorInfo:t,quizType:this.props.quizType||"unknown",questionId:this.props.questionId,sessionId:this.props.sessionId},e)}handleRetry=()=>{this.setState({hasError:!1,error:null,errorInfo:null})};handleGoHome=()=>{window.location.href="/"};handleGoToQuizTab=()=>{window.location.href="/quiz"};render(){if(this.state.hasError){const{error:e}=this.state,t=e?.message?.includes("question")||e?.message?.includes("Question"),r=e?.message?.includes("session")||e?.message?.includes("Session");return a.jsx("div",{className:"flex flex-col items-center justify-center min-h-[400px] bg-gradient-to-br from-purple-50 to-blue-50 dark:from-gray-900 dark:to-gray-800 rounded-xl p-8",children:a.jsxs("div",{className:"bg-white dark:bg-gray-800 p-8 rounded-xl shadow-lg text-center max-w-md w-full",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx(n,{className:"w-16 h-16 text-purple-500 mx-auto mb-4"}),a.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:t?"Question Loading Error":r?"Quiz Session Error":"Quiz Error"}),a.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:t?"Unable to load the current question. This might be a temporary issue.":r?"There was an issue with your quiz session. Your progress may not be saved.":"An unexpected error occurred during the quiz. Don't worry, your progress is safe."})]}),a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsxs("button",{onClick:this.handleRetry,className:"flex items-center justify-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:[a.jsx(u,{className:"w-4 h-4"}),"Try Again"]}),a.jsxs("button",{onClick:this.handleGoToQuizTab,className:"flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:[a.jsx(h,{className:"w-4 h-4"}),"Back to Quiz Selection"]}),a.jsxs("button",{onClick:this.handleGoHome,className:"flex items-center justify-center gap-2 bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-medium transition-colors",children:[a.jsx(o,{className:"w-4 h-4"}),"Go Home"]})]})]})})}return this.props.children}}const he="https://bkuowoowlmwranfoliea.supabase.co";function me(e,t={}){if(!e)return e||"https://via.placeholder.com/150";const r=new URL(e);if(!r.hostname.endsWith("supabase.co")||r.searchParams.has("width"))return e;const{width:s,height:a,quality:n=80,resize:i="cover"}=t,o=new URLSearchParams;s&&o.append("width",s),a&&o.append("height",a),o.append("quality",n),o.append("resize",i);const l=r.pathname.split("/"),c=l[l.length-2],d=l[l.length-1];if(!c||!d)return e;return`${new URL(`/storage/v1/render/image/public/${c}/${d}`,he).href}?${o.toString()}`}const ge=({onSidebarToggle:e,showSidebarToggle:t=!1,isCondensed:r=!1,user:n})=>{const i=m(),{isDarkMode:o,toggleTheme:l}=(()=>{const e=s.useContext(ie);if(!e)throw new Error("useTheme must be used within a ThemeProvider");return e})(),c=e=>{navigator.vibrate&&navigator.vibrate(5),e()};return a.jsx(g.header,{initial:{y:-50,opacity:0},animate:{y:0,opacity:1},className:"bg-white/98 dark:bg-gray-900/98 backdrop-blur-xl shadow-sm border-b border-gray-200/30 dark:border-gray-700/30 sticky top-0 z-40 transition-all duration-300 py-2",style:{paddingTop:r?"8px":"max(8px, env(safe-area-inset-top))",paddingLeft:"env(safe-area-inset-left)",paddingRight:"env(safe-area-inset-right)"},children:a.jsx("div",{className:"flex items-center justify-end px-3 w-full "+(r?"max-w-none":"max-w-full"),children:a.jsxs("div",{className:"flex items-center gap-1",children:[t&&a.jsx(g.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:e,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-xl transition-all duration-200",children:a.jsx(x,{size:20,className:"text-gray-600 dark:text-gray-300"})}),a.jsxs(g.div,{whileHover:{scale:1.05},whileTap:{scale:.95},initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2},className:"flex items-center gap-1 bg-gradient-to-r from-orange-500 via-orange-600 to-red-500 text-white px-2.5 py-1 rounded-full text-xs font-bold shadow-lg shadow-orange-500/25",children:[a.jsx(g.div,{animate:{rotate:[0,-10,10,-5,5,0],scale:[1,1.1,1]},transition:{duration:2,repeat:1/0,repeatDelay:3},children:a.jsx(p,{size:12,className:"drop-shadow-sm"})}),a.jsx("span",{className:"tracking-tight",children:profile?.total_points?.toLocaleString()||"0"})]}),a.jsxs(g.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>c(()=>{}),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-xl transition-all duration-200 relative active:bg-gray-200 dark:active:bg-gray-700",children:[a.jsx(f,{size:16,className:"text-gray-600 dark:text-gray-300",strokeWidth:2}),a.jsx(g.div,{animate:{scale:[1,1.2,1],opacity:[1,.8,1]},transition:{duration:2,repeat:1/0,repeatDelay:1},className:"absolute top-1.5 right-1.5 w-2 h-2 bg-red-500 rounded-full shadow-sm"})]}),a.jsx(g.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>c(l),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-xl transition-all duration-200 active:bg-gray-200 dark:active:bg-gray-700",children:a.jsx(g.div,{animate:{rotate:o?180:0},transition:{type:"spring",stiffness:200,damping:15},children:o?a.jsx(y,{size:16,className:"text-yellow-500 drop-shadow-sm",strokeWidth:2}):a.jsx(b,{size:16,className:"text-gray-600 dark:text-gray-300",strokeWidth:2})})}),a.jsxs(g.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>c(()=>i("/profile")),className:"relative",children:[a.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden shadow-lg ring-2 ring-white/50 dark:ring-gray-700/50 bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:n?.avatar_url?a.jsx("img",{src:me(n.avatar_url,{width:80,height:80}),alt:"Profile",className:"w-full h-full object-cover transition-transform duration-300 hover:scale-110"}):a.jsx(w,{size:18,className:"text-white"})}),a.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-white dark:border-gray-900 shadow-sm"})]})]})})})},xe=()=>{const e=j(),t=m(),r=[{icon:o,label:"Home",path:"/",color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-500",gradient:"from-blue-500 to-blue-600"},{icon:h,label:"Learn",path:"/learn",color:"text-emerald-600 dark:text-emerald-400",bgColor:"bg-emerald-500",gradient:"from-emerald-500 to-emerald-600"},{icon:N,label:"Quiz",path:"/quiz",color:"text-purple-600 dark:text-purple-400",bgColor:"bg-purple-500",gradient:"from-purple-500 to-purple-600"},{icon:v,label:"Chat",path:"/chat",color:"text-pink-600 dark:text-pink-400",bgColor:"bg-pink-500",gradient:"from-pink-500 to-pink-600"},{icon:p,label:"Leaders",path:"/leaderboard",color:"text-orange-600 dark:text-orange-400",bgColor:"bg-orange-500",gradient:"from-orange-500 to-orange-600"}];return a.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white/95 dark:bg-gray-900/95 backdrop-blur-md border-t border-gray-200/50 dark:border-gray-700/50 px-1 py-0.5 z-50",children:a.jsx("div",{className:"flex justify-around items-center max-w-md mx-auto",children:r.map(r=>{const s=r.icon,n="/"===(i=r.path)?"/"===e.pathname:e.pathname.startsWith(i);var i;return a.jsxs(g.button,{onClick:()=>t(r.path),className:"relative flex flex-col items-center justify-center px-1.5 py-1 min-w-0 flex-1",whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:17},children:[a.jsx(g.div,{className:"p-1 rounded-md transition-all duration-200",animate:{scale:n?1.05:1,y:n?-1:0},transition:{type:"spring",stiffness:400,damping:17},children:a.jsx(s,{className:`w-4 h-4 transition-colors duration-200 ${n?r.color:"text-gray-500 dark:text-gray-400"}`})}),a.jsx("span",{className:`text-[9px] font-medium mt-0.5 transition-colors duration-200 ${n?r.color:"text-gray-500 dark:text-gray-400"}`,children:r.label})]},r.path)})})})},pe=({isOpen:e,onToggle:t,isTablet:r})=>{const s=j(),n=m(),{user:i,profile:l}=ae(),c=[{icon:o,label:"Home",path:"/",color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-500",gradient:"from-blue-500 to-blue-600"},{icon:h,label:"Quiz",path:"/quiz",color:"text-purple-600 dark:text-purple-400",bgColor:"bg-purple-500",gradient:"from-purple-500 to-purple-600"},{icon:k,label:"Learn",path:"/learn",color:"text-emerald-600 dark:text-emerald-400",bgColor:"bg-emerald-500",gradient:"from-emerald-500 to-emerald-600"},{icon:p,label:"Leaderboard",path:"/leaderboard",color:"text-orange-600 dark:text-orange-400",bgColor:"bg-orange-500",gradient:"from-orange-500 to-orange-600"},{icon:E,label:"Statistics",path:"/stats",color:"text-green-600 dark:text-green-400",bgColor:"bg-green-500",gradient:"from-green-500 to-green-600"}];return i?.user_metadata?.full_name?.split(" ")[0],a.jsxs(g.div,{initial:{x:-20,opacity:0},animate:{x:0,opacity:1},exit:{x:-20,opacity:0},transition:{type:"spring",stiffness:300,damping:30},className:"h-full bg-white/95 dark:bg-gray-900/95 backdrop-blur-xl border-r border-gray-200/50 dark:border-gray-700/50 flex flex-col w-full "+(r?"fixed left-0 top-0 z-50 w-72":""),children:[a.jsxs("div",{className:"p-3 border-b border-gray-200/30 dark:border-gray-700/30",children:[a.jsxs(g.div,{initial:{y:-10,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1},className:"flex items-center space-x-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center",children:a.jsx(k,{size:20,className:"text-white"})}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"USMLE Trivia"}),a.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Study Smart, Score High"})]})]}),r&&a.jsx("button",{onClick:t,className:"absolute top-3 right-3 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:a.jsx(_,{size:18,className:"text-gray-500 dark:text-gray-400"})})]}),a.jsx("nav",{className:"flex-1 p-3",children:a.jsx("div",{className:"space-y-1",children:c.map(e=>{const t=e.icon,r="/"===(i=e.path)?"/"===s.pathname:s.pathname.startsWith(i);var i;return a.jsxs(g.button,{onClick:()=>n(e.path),className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg transition-all duration-200 group "+(r?"text-gray-900 dark:text-white bg-gray-100/50 dark:bg-gray-800/50":"text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 hover:text-gray-900 dark:hover:text-gray-200"),whileHover:{scale:1.01},whileTap:{scale:.99},children:[a.jsx("div",{className:"p-1.5 rounded-md transition-all duration-200 "+(r?`${e.color} bg-gray-200 dark:bg-gray-700`:"bg-gray-100 dark:bg-gray-700 group-hover:bg-gray-200 dark:group-hover:bg-gray-600"),children:a.jsx(t,{size:16})}),a.jsx("span",{className:"font-medium text-sm",children:e.label})]},e.path)})})}),a.jsx("div",{className:"p-3 border-t border-gray-200/30 dark:border-gray-700/30",children:a.jsxs(g.button,{onClick:()=>n("/profile"),className:"w-full flex items-center space-x-2 px-3 py-2.5 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 hover:text-gray-900 dark:hover:text-gray-200 transition-all duration-200",whileHover:{scale:1.01},whileTap:{scale:.99},children:[a.jsx("div",{className:"p-1.5 rounded-md bg-gray-100 dark:bg-gray-700",children:a.jsx(w,{size:16})}),a.jsx("span",{className:"font-medium text-sm",children:"Profile"})]})})]})},fe=[],ye=[],be=({children:e})=>{const{user:t}=ae(),[r,n]=s.useState(!1),[i,o]=s.useState(!0),l=j();s.useEffect(()=>{const e=()=>{const e=window.innerWidth<768;o(e),!e&&window.innerWidth>=1024?n(!0):e&&n(!1)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const c=()=>{n(!r)},d=!fe.includes(l.pathname),u=!ye.includes(l.pathname);return a.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-300",style:{paddingLeft:"env(safe-area-inset-left)",paddingRight:"env(safe-area-inset-right)"},children:i?a.jsxs("div",{className:"flex flex-col min-h-screen",children:[d&&a.jsx(ge,{user:t}),a.jsx("main",{className:"flex-1 relative",children:a.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.25,.46,.45,.94]},className:"container mx-auto px-3 py-2 max-w-full sm:max-w-screen-sm min-h-full",children:e})}),u&&a.jsx(xe,{})]}):a.jsxs("div",{className:"flex min-h-screen w-full overflow-hidden",children:[r&&a.jsx("div",{className:"w-[15%] min-w-[180px] max-w-[200px] flex-shrink-0",children:a.jsx(pe,{isOpen:r,onToggle:c,isTablet:window.innerWidth<1024})}),a.jsxs("div",{className:(r?"w-[85%]":"w-full")+" flex flex-col min-h-screen overflow-hidden transition-all duration-300",children:[d&&a.jsx(ge,{onSidebarToggle:c,showSidebarToggle:window.innerWidth<1024,isCondensed:!1,user:t}),a.jsx("main",{className:"flex-1 overflow-auto",children:a.jsx(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.25,.46,.45,.94]},className:"h-full px-4 py-4",children:a.jsx("div",{className:"max-w-full h-full",children:e})})})]}),r&&window.innerWidth<1024&&a.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 z-50",onClick:()=>n(!1)})]})})},we=()=>a.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-primary-600 via-secondary-600 to-purple-700 flex items-center justify-center",children:[a.jsxs("div",{className:"text-center",children:[a.jsx(g.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{type:"spring",stiffness:260,damping:20,duration:1.2},className:"mb-8",children:a.jsxs("div",{className:"relative mx-auto w-24 h-24 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm border border-white/30",children:[a.jsx(C,{className:"w-12 h-12 text-white"}),a.jsx("div",{className:"absolute -top-2 -right-2",children:a.jsx("div",{className:"w-6 h-6 bg-accent-400 rounded-full flex items-center justify-center",children:a.jsx(T,{className:"w-3 h-3 text-white"})})})]})}),a.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5,duration:.6},className:"mb-4",children:[a.jsx("h1",{className:"text-4xl font-bold text-white mb-2",children:"USMLE Trivia"}),a.jsx("p",{className:"text-white/80 text-lg",children:"Master Medicine, One Question at a Time"})]}),a.jsxs(g.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.8,duration:.6},className:"flex flex-wrap justify-center gap-4 mb-8",children:[a.jsxs("div",{className:"flex items-center space-x-2 bg-white/20 rounded-full px-4 py-2 backdrop-blur-sm",children:[a.jsx(h,{className:"w-4 h-4 text-white"}),a.jsx("span",{className:"text-white text-sm font-medium",children:"Study Smart"})]}),a.jsxs("div",{className:"flex items-center space-x-2 bg-white/20 rounded-full px-4 py-2 backdrop-blur-sm",children:[a.jsx(p,{className:"w-4 h-4 text-white"}),a.jsx("span",{className:"text-white text-sm font-medium",children:"Track Progress"})]})]}),a.jsx(g.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1.2,duration:.4},className:"flex justify-center",children:a.jsx("div",{className:"flex space-x-2",children:[0,1,2].map(e=>a.jsx(g.div,{animate:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:{duration:1.5,repeat:1/0,delay:.2*e},className:"w-2 h-2 bg-white rounded-full"},e))})})]}),a.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:a.jsx(g.div,{animate:{backgroundPosition:["0% 0%","100% 100%"]},transition:{duration:20,repeat:1/0,repeatType:"reverse",ease:"linear"},className:"absolute inset-0 opacity-10",style:{backgroundImage:"radial-gradient(circle at 25% 25%, white 2px, transparent 2px),\n                             radial-gradient(circle at 75% 75%, white 2px, transparent 2px)",backgroundSize:"40px 40px"}})})]}),je=({children:e})=>{const{user:t,loading:r}=ae(),s=j();if(r)return a.jsx(we,{});if(!t){return["/login","/welcome","/signup","/forgot-password"].includes(s.pathname)?a.jsx(we,{}):a.jsx(R,{to:"/welcome",state:{from:s},replace:!0})}return e},Ne=()=>a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-expo-950",children:a.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"}),a.jsx("div",{className:"absolute inset-0 w-12 h-12 border-4 border-transparent border-t-blue-400 rounded-full animate-spin opacity-60",style:{animationDelay:"-0.15s"}})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 animate-pulse",children:"Loading..."}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Preparing your USMLE experience"})]})]})}),ve={FETCH_QUESTIONS_ERROR:{title:"Question Loading Failed",message:"Unable to load quiz questions. Please check your connection and try again.",severity:"error",actions:["retry","goHome"]},USER_HISTORY_ERROR:{title:"Progress Tracking Issue",message:"Your progress may not be saved properly, but you can continue the quiz.",severity:"warning",actions:["continue"]},SESSION_CREATION_ERROR:{title:"Quiz Setup Failed",message:"Unable to start the quiz session. Please try again.",severity:"error",actions:["retry","goHome"]},RESPONSE_RECORDING_ERROR:{title:"Answer Not Saved",message:"Your answer may not have been recorded. You can continue, but progress might be lost.",severity:"warning",actions:["continue","retry"]},INSUFFICIENT_QUESTIONS_ERROR:{title:"Not Enough Questions",message:"There aren't enough questions available for your selection. Try adjusting your filters.",severity:"info",actions:["goBack","tryDifferentSettings"]},AUTHENTICATION_ERROR:{title:"Authentication Required",message:"Please log in to continue with your quiz.",severity:"error",actions:["login","goHome"]},NETWORK_ERROR:{title:"Connection Problem",message:"Check your internet connection and try again.",severity:"error",actions:["retry","offline"]},UNKNOWN_ERROR:{title:"Something Went Wrong",message:"An unexpected error occurred. Please try again.",severity:"error",actions:["retry","goHome"]}},ke={retry:{label:"Try Again",variant:"primary",handler:e=>e.retry?.()},goHome:{label:"Go Home",variant:"secondary",handler:e=>e.navigate?.("/")},goBack:{label:"Go Back",variant:"secondary",handler:e=>e.navigate?.(-1)},continue:{label:"Continue Anyway",variant:"secondary",handler:e=>e.continue?.()},login:{label:"Log In",variant:"primary",handler:e=>e.navigate?.("/login")},offline:{label:"Use Offline Mode",variant:"secondary",handler:e=>e.enableOfflineMode?.()},tryDifferentSettings:{label:"Change Settings",variant:"secondary",handler:e=>e.navigate?.(-1)}};const _e=new class{constructor(){this.notifications=new Map,this.retryAttempts=new Map,this.maxRetries=3,this.retryDelay=1e3}show(e,t=null,r={}){const s=ve[e]||ve.UNKNOWN_ERROR,a=this._generateId(),n={id:a,type:e,title:s.title,message:t||s.message,severity:s.severity,actions:s.actions.map(e=>({...ke[e],key:e})),context:r,timestamp:Date.now(),dismissed:!1};return this.notifications.set(a,n),J.info("User notification shown",{notificationId:a,type:e,severity:s.severity,hasCustomMessage:!!t}),"error"!==s.severity&&setTimeout(()=>this.dismiss(a),1e4),n}dismiss(e){const t=this.notifications.get(e);t&&(t.dismissed=!0,this.notifications.delete(e),J.debug("Notification dismissed",{notificationId:e}))}dismissAll(){const e=this.notifications.size;this.notifications.clear(),J.debug("All notifications dismissed",{count:e})}getAll(){return Array.from(this.notifications.values()).filter(e=>!e.dismissed)}async handleWithRetry(e,t,r={}){const s=`${t}_${Date.now()}`;this.retryAttempts.set(s,0);const a=async()=>{const n=this.retryAttempts.get(s)||0;try{J.debug("Attempting operation",{operationName:t,attempt:n+1});const r=await e();return this.retryAttempts.delete(s),J.info("Operation succeeded",{operationName:t,attempts:n+1}),r}catch(i){const e=n+1;if(this.retryAttempts.set(s,e),J.warn("Operation failed",{operationName:t,attempt:e,error:i.message}),e>=this.maxRetries)throw this.retryAttempts.delete(s),this._handleFinalError(i,t,r),i;{const r=this.retryDelay*Math.pow(2,e-1);return J.info("Scheduling retry",{operationName:t,delay:r,attempt:e+1}),await this._delay(r),a()}}};return a()}_handleFinalError(e,t,r){const s=this._classifyError(e,t),a=this.show(s,null,{...r,retry:()=>this.handleWithRetry(r.operation,t,r),originalError:e});J.error("Operation failed after all retries",{operationName:t,errorType:s,notificationId:a.id},e)}_classifyError(e,t){if(e.message?.includes("fetch")||e.message?.includes("network"))return"NETWORK_ERROR";if(e.message?.includes("auth")||401===e.status)return"AUTHENTICATION_ERROR";if(e.message?.includes("not enough")||e.message?.includes("no questions"))return"INSUFFICIENT_QUESTIONS_ERROR";switch(t){case"fetchQuestions":case"fetchQuestionsForUser":return"FETCH_QUESTIONS_ERROR";case"createQuizSession":return"SESSION_CREATION_ERROR";case"recordQuizResponse":return"RESPONSE_RECORDING_ERROR";case"updateUserQuestionHistory":return"USER_HISTORY_ERROR";default:return"UNKNOWN_ERROR"}}_generateId(){return`notification_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}_delay(e){return new Promise(t=>setTimeout(t,e))}showSuccess(e,t=5e3){const r=this._generateId(),s={id:r,type:"SUCCESS",title:"Success",message:e,severity:"success",actions:[],timestamp:Date.now(),dismissed:!1};return this.notifications.set(r,s),setTimeout(()=>this.dismiss(r),t),J.info("Success notification shown",{message:e}),s}showInfo(e,t=8e3){const r=this._generateId(),s={id:r,type:"INFO",title:"Information",message:e,severity:"info",actions:[],timestamp:Date.now(),dismissed:!1};return this.notifications.set(r,s),setTimeout(()=>this.dismiss(r),t),J.info("Info notification shown",{message:e}),s}},Ee=()=>{const[e,t]=s.useState([]);s.useEffect(()=>{const e=setInterval(()=>{const e=_e.getAll();t(e)},100);return()=>clearInterval(e)},[]);const r=e=>{switch(e){case"error":return a.jsx(d,{className:"w-5 h-5 text-red-500"});case"warning":return a.jsx(n,{className:"w-5 h-5 text-yellow-500"});case"success":return a.jsx(A,{className:"w-5 h-5 text-green-500"});default:return a.jsx(I,{className:"w-5 h-5 text-blue-500"})}},i=e=>{switch(e){case"error":return"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-800";case"warning":return"bg-yellow-50 border-yellow-200 dark:bg-yellow-900/20 dark:border-yellow-800";case"success":return"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800";default:return"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800"}},o=e=>{t(t=>t.filter(t=>t.id!==e))};return 0===e.length?null:a.jsxs("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-w-md",children:[a.jsx(S,{children:e.map(e=>a.jsx(g.div,{initial:{opacity:0,x:300,scale:.8},animate:{opacity:1,x:0,scale:1},exit:{opacity:0,x:300,scale:.8},transition:{duration:.3,type:"spring",stiffness:300,damping:25},className:`\n              p-4 rounded-lg border shadow-lg backdrop-blur-sm\n              ${i(e.severity)}\n            `,children:a.jsxs("div",{className:"flex items-start gap-3",children:[r(e.severity),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 text-sm",children:e.title}),a.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm mt-1",children:e.message}),e.actions&&e.actions.length>0&&a.jsx("div",{className:"flex gap-2 mt-3",children:e.actions.map(t=>a.jsx("button",{onClick:()=>((e,t)=>{e.handler(t.context),o(t.id)})(t,e),className:`\n                          px-3 py-1.5 text-xs font-medium rounded-md transition-colors\n                          ${"primary"===t.variant?"bg-blue-600 text-white hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600":"bg-gray-200 text-gray-800 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-200 dark:hover:bg-gray-600"}\n                        `,children:t.label},t.key))})]}),a.jsx("button",{onClick:()=>o(e.id),className:"text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 transition-colors",children:a.jsx(_,{className:"w-4 h-4"})})]})},e.id))}),e.length>1&&a.jsxs(g.button,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>{_e.dismissAll(),t([])},className:"w-full mt-2 px-3 py-2 text-xs font-medium text-gray-600 dark:text-gray-400 \r\n                     bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-md border border-gray-200 dark:border-gray-700\r\n                     hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:["Dismiss All (",e.length,")"]})]})},Ce=s.lazy(()=>O(()=>import("./Home-CgUZRXGU.js"),__vite__mapDeps([0,1,2]))),Te=s.lazy(()=>O(()=>import("./QuizTab-WIgWyCIv.js"),__vite__mapDeps([3,1,2]))),Re=s.lazy(()=>O(()=>import("./Profile-BdNOnr53.js"),__vite__mapDeps([4,1,5]))),Se=s.lazy(()=>O(()=>import("./Leaderboard-SseSZeHy.js"),__vite__mapDeps([6,1,5]))),Ie=s.lazy(()=>O(()=>import("./Learn-C50f5w3i.js"),__vite__mapDeps([7,1]))),Ae=s.lazy(()=>O(()=>import("./QuickQuiz-DojiPJyt.js"),__vite__mapDeps([8,1,9,10,11]))),Oe=s.lazy(()=>O(()=>import("./TimedTest-BlAqdRQ6.js"),__vite__mapDeps([12,1,9,10,11]))),Pe=s.lazy(()=>O(()=>import("./TimedTestSetup-2KrRBu4A.js"),__vite__mapDeps([13,1]))),ze=s.lazy(()=>O(()=>import("./Results-CkRKTyYP.js"),__vite__mapDeps([14,1]))),qe=s.lazy(()=>O(()=>import("./CustomQuiz-BqPLfMjN.js"),__vite__mapDeps([15,1,9,10,11]))),Ue=s.lazy(()=>O(()=>import("./BlockTest-0Lkx25yq.js"),__vite__mapDeps([16,1]))),De=s.lazy(()=>O(()=>import("./Login-BoMXxjYB.js"),__vite__mapDeps([17,1,18]))),Le=s.lazy(()=>O(()=>import("./SignUp-DSsV_Wuo.js"),__vite__mapDeps([19,1,18]))),Fe=s.lazy(()=>O(()=>import("./ForgotPassword-CgCm4m93.js"),__vite__mapDeps([20,1]))),$e=s.lazy(()=>O(()=>import("./Welcome-Cgchj79g.js"),__vite__mapDeps([21,1]))),Qe=s.lazy(()=>O(()=>import("./Privacy-Bbb3IZ8v.js"),__vite__mapDeps([22,1]))),He=s.lazy(()=>O(()=>import("./Terms-bVyy87sF.js"),__vite__mapDeps([23,1]))),Me=s.lazy(()=>O(()=>import("./Chat-vI_7uRLk.js"),__vite__mapDeps([24,1])));function We(){return a.jsxs(le,{children:[a.jsx(Ee,{}),a.jsxs(P,{children:[a.jsx(z,{path:"/login",element:a.jsx(ce,{authFlow:"login",children:a.jsx(s.Suspense,{fallback:a.jsx(we,{}),children:a.jsx(De,{})})})}),a.jsx(z,{path:"/signup",element:a.jsx(ce,{authFlow:"signup",children:a.jsx(s.Suspense,{fallback:a.jsx(we,{}),children:a.jsx(Le,{})})})}),a.jsx(z,{path:"/forgot-password",element:a.jsx(ce,{authFlow:"forgot-password",children:a.jsx(s.Suspense,{fallback:a.jsx(we,{}),children:a.jsx(Fe,{})})})}),a.jsx(z,{path:"/welcome",element:a.jsx(ce,{authFlow:"welcome",children:a.jsx(s.Suspense,{fallback:a.jsx(we,{}),children:a.jsx($e,{})})})}),a.jsx(z,{path:"/privacy",element:a.jsx(s.Suspense,{fallback:a.jsx(Ne,{}),children:a.jsx(Qe,{})})}),a.jsx(z,{path:"/terms",element:a.jsx(s.Suspense,{fallback:a.jsx(Ne,{}),children:a.jsx(He,{})})}),a.jsx(z,{path:"/*",element:a.jsx(je,{children:a.jsx(de,{queryType:"app-data",children:a.jsx(be,{children:a.jsx(s.Suspense,{fallback:a.jsx(Ne,{}),children:a.jsxs(P,{children:[a.jsx(z,{path:"/",element:a.jsx(de,{queryType:"home-data",children:a.jsx(Ce,{})})}),a.jsx(z,{path:"/quiz",element:a.jsx(de,{queryType:"quiz-categories",children:a.jsx(Te,{})})}),a.jsx(z,{path:"/chat",element:a.jsx(Me,{})}),a.jsx(z,{path:"/quiz/:categoryId",element:a.jsx(ue,{quizType:"quick-quiz",children:a.jsx(Ae,{})})}),a.jsx(z,{path:"/profile",element:a.jsx(de,{queryType:"profile-data",children:a.jsx(Re,{})})}),a.jsx(z,{path:"/leaderboard",element:a.jsx(de,{queryType:"leaderboard-data",children:a.jsx(Se,{})})}),a.jsx(z,{path:"/learn",element:a.jsx(de,{queryType:"learn-content",children:a.jsx(Ie,{})})}),a.jsx(z,{path:"/quick-quiz",element:a.jsx(ue,{quizType:"quick-quiz",children:a.jsx(Ae,{})})}),a.jsx(z,{path:"/timed-test-setup",element:a.jsx(ue,{quizType:"timed-test-setup",children:a.jsx(Pe,{})})}),a.jsx(z,{path:"/timed-test",element:a.jsx(ue,{quizType:"timed-test",children:a.jsx(Oe,{})})}),a.jsx(z,{path:"/custom-quiz",element:a.jsx(ue,{quizType:"custom-quiz",children:a.jsx(qe,{})})}),a.jsx(z,{path:"/block-test",element:a.jsx(ue,{quizType:"block-test",children:a.jsx(Ue,{})})}),a.jsx(z,{path:"/results",element:a.jsx(ue,{quizType:"results",children:a.jsx(ze,{})})})]})})})})})})]})]})}q.createRoot(document.getElementById("root")).render(a.jsx(s.StrictMode,{children:a.jsx(U,{client:L,children:a.jsx(D,{children:a.jsx(ne,{children:a.jsxs(oe,{children:[a.jsx(We,{}),!1]})})})})}));export{Ne as L,re as a,V as b,K as c,me as g,J as l,H as s,W as t,ae as u,te as w};
