import{r as e,j as t,m as s,u as a,at as r}from"./vendor-CNKhjeNv.js";import{s as i}from"./index-CDKLLn8k.js";async function n(){try{const{data:e,error:t}=await i.from("question_tags").select("\n        tag_id,\n        tags!inner(type)\n      ").eq("tags.type","subject").eq("tags.is_active",!0);if(t)throw t;const s={};return e.forEach(e=>{s[e.tag_id]=(s[e.tag_id]||0)+1}),s}catch(e){return console.error("Error fetching question counts by subject:",e),{}}}async function o(){try{const{data:e,error:t}=await i.from("question_tags").select("\n        tag_id,\n        tags!inner(type)\n      ").eq("tags.type","system").eq("tags.is_active",!0);if(t)throw t;const s={};return e.forEach(e=>{s[e.tag_id]=(s[e.tag_id]||0)+1}),s}catch(e){return console.error("Error fetching question counts by system:",e),{}}}async function l(){try{const{data:e,error:t}=await i.from("question_tags").select("\n        tag_id,\n        tags!inner(type)\n      ").eq("tags.type","topic").eq("tags.is_active",!0);if(t)throw t;const s={};return e.forEach(e=>{s[e.tag_id]=(s[e.tag_id]||0)+1}),s}catch(e){return console.error("Error fetching question counts by topic:",e),{}}}const d=()=>{const t=[{id:"mixed",name:"Mixed Questions",icon:"🎯",description:"Questions from all medical subjects"},{id:"cardiology",name:"Cardiology",icon:"❤️",description:"Heart and cardiovascular system"},{id:"neurology",name:"Neurology",icon:"🧠",description:"Brain and nervous system"},{id:"respiratory",name:"Respiratory",icon:"🫁",description:"Lungs and breathing system"},{id:"gastroenterology",name:"Gastroenterology",icon:"🫃",description:"Digestive system"},{id:"endocrinology",name:"Endocrinology",icon:"🩺",description:"Hormones and metabolism"},{id:"infectious",name:"Infectious Disease",icon:"🦠",description:"Infections and immunity"},{id:"pharmacology",name:"Pharmacology",icon:"💊",description:"Medications and treatments"}],[s,a]=e.useState(!0),[r,d]=e.useState([]),[c,u]=e.useState([]),[g,m]=e.useState([]),[y,x]=e.useState(""),[b,h]=e.useState(""),[p,f]=e.useState(""),[j,v]=e.useState(""),[k,w]=e.useState(10),[N,S]=e.useState("timed"),[C,q]=e.useState(!0),[_,Q]=e.useState(null),[E,T]=e.useState({subjects:{},systems:{},topics:{}}),[M,D]=e.useState(0);e.useEffect(()=>{(async()=>{try{q(!0),Q(null);const{data:e,error:t}=await i.from("tags").select("id, name, slug").eq("type","subject").eq("is_active",!0).order("order_index",{ascending:!0});if(t)throw t;d(e||[]);const s=await async function(){try{const[e,t,s]=await Promise.all([n(),o(),l()]);return{subjects:e,systems:t,topics:s}}catch(_){return console.error("Error fetching all question counts:",_),{subjects:{},systems:{},topics:{}}}}();T(s)}catch(e){console.error("Error loading quiz setup data:",e),Q(e.message)}finally{q(!1)}})()},[]),e.useEffect(()=>{(async()=>{if(!y)return u([]),void h("");try{const{data:e,error:t}=await i.from("tags").select("id, name, slug").eq("type","system").eq("parent_id",y).eq("is_active",!0).order("order_index",{ascending:!0});if(t)throw t;u(e||[]),h(""),f("")}catch(e){console.error("Error loading systems:",e),Q(e.message)}})()},[y]),e.useEffect(()=>{(async()=>{if(!b)return m([]),void f("");try{const{data:e,error:t}=await i.from("tags").select("id, name, slug").eq("type","topic").eq("parent_id",b).eq("is_active",!0).order("order_index",{ascending:!0});if(t)throw t;m(e||[]),f("")}catch(e){console.error("Error loading topics:",e),Q(e.message)}})()},[b]),e.useEffect(()=>{(async()=>{if(y&&b)try{const e=await async function(){return 0}();D(e)}catch(e){console.error("Error getting available question count:",e),D(0)}else D(0)})()},[y,b,p,j]);return{isSimpleMode:s,subjects:r,systems:c,topics:g,selectedSubject:y,selectedSystem:b,selectedTopic:p,difficulty:j,questionCount:k,timing:N,loading:C,error:_,questionCounts:E,availableQuestions:M,simpleCategories:t,canStart:s?y&&k>0&&k<=40:y&&b&&k>0&&k<=40&&M>0,setIsSimpleMode:a,setSelectedSubject:x,setSelectedSystem:h,setSelectedTopic:f,setDifficulty:v,setQuestionCount:w,setTiming:S,createNavigationState:()=>s?{categoryId:y,categoryName:t.find(e=>e.id===y)?.name||"Mixed Questions",questionCount:k,difficulty:j||null,timePerQuestion:60,quizMode:"custom",autoAdvance:!0,showExplanations:!0}:{subjectId:y,systemId:b,topicId:p||null,difficulty:j,questionCount:k,timing:N}}},c=({isSimpleMode:e,onModeChange:s})=>t.jsx("div",{className:"flex items-center justify-center mb-6",children:t.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 rounded-lg p-1 flex",children:[t.jsx("button",{type:"button",onClick:()=>s(!0),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+(e?"bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:"Simple Mode"}),t.jsx("button",{type:"button",onClick:()=>s(!1),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+(e?"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white":"bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm"),children:"Advanced Mode"})]})}),u=({simpleCategories:e,selectedSubject:a,onSubjectChange:r,questionCount:i,onQuestionCountChange:n,difficulty:o,onDifficultyChange:l,difficultyOptions:d})=>t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block font-medium text-gray-800 dark:text-gray-200 mb-3",children:"Select Category"}),t.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.map(e=>t.jsxs(s.button,{type:"button",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>r(e.id),className:"p-4 rounded-lg border-2 text-left transition-all "+(a===e.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx("span",{className:"text-2xl mr-3",children:e.icon}),t.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:e.name})]}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]},e.id))})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"questionCount",className:"block font-medium text-gray-800 dark:text-gray-200 mb-3",children:"Number of Questions"}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("input",{type:"range",min:"5",max:"40",value:i,onChange:e=>n(Number(e.target.value)),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"}),t.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400 min-w-[3rem] text-center",children:i})]}),t.jsxs("div",{className:"flex justify-between text-sm text-gray-500 dark:text-gray-400 mt-2",children:[t.jsx("span",{children:"5 questions"}),t.jsx("span",{children:"40 questions"})]}),t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["Estimated time: ",Math.round(60*i/60)," minutes"]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block font-medium text-gray-800 dark:text-gray-200 mb-3",children:"Difficulty Level"}),t.jsx("div",{className:"grid grid-cols-2 gap-3",children:d.map(e=>t.jsx(s.button,{type:"button",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>l(e.value),className:"p-3 rounded-lg border-2 text-center transition-all "+(o===e.value?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:t.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.label})},e.value))})]})]}),g=({subjects:e,systems:s,topics:a,selectedSubject:r,selectedSystem:i,selectedTopic:n,onSubjectChange:o,onSystemChange:l,onTopicChange:d,difficulty:c,onDifficultyChange:u,questionCount:g,onQuestionCountChange:m,timing:y,onTimingChange:x,questionCounts:b,availableQuestions:h,difficultyOptions:p,timingOptions:f,loading:j})=>j?t.jsx("div",{className:"space-y-6",children:t.jsx("div",{className:"text-gray-500",children:"Loading options..."})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"subject",className:"block font-medium text-gray-800 dark:text-gray-200 mb-1",children:["Subject ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("select",{id:"subject",value:r,onChange:e=>o(e.target.value),className:"w-full rounded-lg border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-2",required:!0,children:[t.jsx("option",{value:"",children:"Select a subject"}),e.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",b.subjects[e.id]||0," questions)"]},e.id))]})]}),t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"system",className:"block font-medium text-gray-800 dark:text-gray-200 mb-1",children:["System ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("select",{id:"system",value:i,onChange:e=>l(e.target.value),className:"w-full rounded-lg border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-2",disabled:!r,required:!0,children:[t.jsx("option",{value:"",children:"Select a system"}),s.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",b.systems[e.id]||0," questions)"]},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"topic",className:"block font-medium text-gray-800 dark:text-gray-200 mb-1",children:"Topic (Optional)"}),t.jsxs("select",{id:"topic",value:n,onChange:e=>d(e.target.value),className:"w-full rounded-lg border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-2",disabled:!i,children:[t.jsx("option",{value:"",children:"All topics"}),a.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",b.topics[e.id]||0," questions)"]},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"difficulty",className:"block font-medium text-gray-800 dark:text-gray-200 mb-1",children:"Difficulty"}),t.jsx("select",{id:"difficulty",value:c,onChange:e=>u(e.target.value),className:"w-full rounded-lg border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-2",children:p.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"questionCount",className:"block font-medium text-gray-800 dark:text-gray-200 mb-1",children:"Number of Questions"}),t.jsx("input",{id:"questionCount",type:"number",min:1,max:40,value:g,onChange:e=>m(Number(e.target.value)),className:"w-full rounded-lg border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-2"}),t.jsx("span",{className:"text-xs text-gray-500",children:"1–40 questions"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"timing",className:"block font-medium text-gray-800 dark:text-gray-200 mb-1",children:"Timing"}),t.jsx("select",{id:"timing",value:y,onChange:e=>x(e.target.value),className:"w-full rounded-lg border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-2",children:f.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),r&&i&&t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"Available Questions:"}),t.jsx("span",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:h})]}),0===h&&t.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:"No questions available for this combination. Try selecting different options."}),h>0&&g>h&&t.jsxs("p",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1",children:["Requested ",g," questions, but only ",h," available. Quiz will include all available questions."]})]})]}),m=[{value:"",label:"Mixed"},{value:"easy",label:"Easy"},{value:"medium",label:"Medium"},{value:"hard",label:"Hard"}],y=[{value:"timed",label:"Timed (1 min/question)"},{value:"self",label:"Self-paced"}],x=()=>{const e=a(),{isSimpleMode:s,subjects:i,systems:n,topics:o,selectedSubject:l,selectedSystem:x,selectedTopic:b,difficulty:h,questionCount:p,timing:f,loading:j,error:v,questionCounts:k,availableQuestions:w,simpleCategories:N,canStart:S,setIsSimpleMode:C,setSelectedSubject:q,setSelectedSystem:_,setSelectedTopic:Q,setDifficulty:E,setQuestionCount:T,setTiming:M,createNavigationState:D}=d();return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-emerald-50 to-teal-100 dark:from-gray-900 dark:via-green-900/20 dark:to-emerald-900/20 flex items-center justify-center p-4",children:t.jsxs("form",{onSubmit:t=>{if(t.preventDefault(),!S)return;const s=D();e("/custom-quiz",{state:s})},className:"w-full max-w-lg bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 space-y-6","aria-label":"Custom Quiz Setup",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Custom Quiz Setup"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Select your desired filters and options to create a personalized quiz session."}),t.jsx(c,{isSimpleMode:s,onModeChange:C}),v&&t.jsx("div",{className:"text-red-600 bg-red-100 dark:bg-red-900/20 p-2 rounded",children:v}),s?t.jsx(u,{simpleCategories:N,selectedSubject:l,onSubjectChange:q,questionCount:p,onQuestionCountChange:T,difficulty:h,onDifficultyChange:E,difficultyOptions:m}):t.jsx(g,{subjects:i,systems:n,topics:o,selectedSubject:l,selectedSystem:x,selectedTopic:b,onSubjectChange:q,onSystemChange:_,onTopicChange:Q,difficulty:h,onDifficultyChange:E,questionCount:p,onQuestionCountChange:T,timing:f,onTimingChange:M,questionCounts:k,availableQuestions:w,difficultyOptions:m,timingOptions:y,loading:j}),t.jsxs("button",{type:"submit",disabled:!S||!s&&0===w,className:"w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-semibold text-white transition-all "+(S&&(s||w>0)?"bg-green-600 hover:bg-green-700 shadow-lg":"bg-gray-400 cursor-not-allowed"),children:["Start Custom Quiz",t.jsx(r,{className:"w-5 h-5"})]})]})})};export{x as default};
