import{j as e,aH as t,r as s,m as a,an as i,u as r,d as n,b as l,aJ as o,aL as c,aj as d}from"./vendor-ChsRwzkX.js";import{u}from"./index-CwYISt8q.js";import{c as m,d as x,e as g,f as h,u as p,g as y,Q as b,a as f,b as j}from"./QuizError-DN33deu4.js";import"./questionService-DCaLMc6P.js";const w=({isFetching:s})=>e.jsxs("div",{className:"flex flex-col justify-center items-center h-screen",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading quiz questions..."}),s&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Fetching latest questions ",e.jsx(t,{size:16,className:"inline-block animate-pulse"})]})]}),k=({totalTimeLeft:t,formatTime:s,isLowTime:r,isCriticalTime:n,currentQuestionIndex:l,questionCount:o,getEstimatedTimeForQuestion:c})=>{const d=c(l,o);return e.jsxs(a.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"flex justify-between items-center mb-6 rounded-xl p-4 shadow-lg transition-all "+(n?"bg-red-100 dark:bg-red-900/30 border-2 border-red-400":r?"bg-orange-100 dark:bg-orange-900/30 border-2 border-orange-400":"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700"),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(i,{className:"w-6 h-6 "+(n?"text-red-600 animate-pulse":r?"text-orange-600":"text-blue-600")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold tabular-nums "+(n?"text-red-600 animate-pulse":r?"text-orange-600":"text-gray-900 dark:text-white"),children:s()}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:n?"Time almost up!":r?"Time running low":"Total Time Remaining"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Question ",l+1," of ",o]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["~",d,"s suggested for this question"]})]})]})},N=({score:t,questionCount:s,accuracy:l,userAnswers:o,timeTaken:c,totalTimeLeft:d,difficulty:u,quizSession:m,isOffline:x,questions:g,onGoHome:h})=>{const p=r(),y=Math.round(c/s);return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-blue-900/20 dark:to-purple-900/20",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(a.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-blue-600 text-white mb-4",children:e.jsx(i,{className:"w-8 h-8"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Timed Test Complete!"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Time taken: ",Math.floor(c/60),":",(c%60).toString().padStart(2,"0")]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white dark:bg-gray-800 rounded-xl p-6 text-center shadow-lg",children:[e.jsxs("div",{className:"text-4xl font-bold text-blue-600 mb-2",children:[t,"/",s]}),e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"Questions Correct"})]}),e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white dark:bg-gray-800 rounded-xl p-6 text-center shadow-lg",children:[e.jsxs("div",{className:"text-4xl font-bold text-purple-600 mb-2",children:[l,"%"]}),e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"Accuracy"})]}),e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-white dark:bg-gray-800 rounded-xl p-6 text-center shadow-lg",children:[e.jsxs("div",{className:"text-4xl font-bold text-green-600 mb-2",children:[y,"s"]}),e.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"Avg Time/Question"})]})]}),e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"bg-white dark:bg-gray-800 rounded-xl p-6 mb-8 shadow-lg",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Performance Summary"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Questions Answered"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:[o.length,"/",s]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Time Remaining"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:[Math.floor(d/60),":",(d%60).toString().padStart(2,"0")]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Difficulty"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:u||"Mixed"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Test Type"}),e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:"Timed Test (30 min)"})]})]})]}),e.jsxs(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsx("button",{onClick:h,className:"flex items-center justify-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-xl transition-colors",children:e.jsx("span",{children:"Back to Home"})}),e.jsxs("button",{onClick:()=>{p("/results",{state:{score:t,totalQuestions:s,questions:g,quizResponses:o,quizType:"timed-test",sessionId:m?.id,isOffline:x}})},className:"flex items-center justify-center space-x-2 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-xl transition-colors",children:[e.jsx(n,{className:"w-5 h-5"}),e.jsx("span",{children:"View Detailed Review"})]})]})]})})})},v=()=>{const t=r(),i=l(),{user:n}=u(),{difficulty:v=null}=i.state||{},T="mixed",S=20,{getOfflineData:C}=p(),{data:q=[],isLoading:A,error:I,isError:Q}=y(T,S,v,{enabled:!!n,retry:(e,t)=>!C(T,S)&&e<2}),O=s.useMemo(()=>Q&&q.length>0,[Q,q.length]),{currentQuestionIndex:L,currentQuestion:_,selectedOption:E,isAnswered:z,score:M,userAnswers:R,showResults:F,showExplanation:D,progress:H,accuracy:P,canSubmit:$,handleOptionSelect:G,submitAnswer:U,nextQuestion:B,completeTest:J}=((e=[],t=20)=>{const[a,i]=s.useState(0),[r,n]=s.useState(null),[l,o]=s.useState(!1),[c,d]=s.useState(0),[u,m]=s.useState([]),[x,g]=s.useState(!1),[h,p]=s.useState(!1),y=e[a]||null,b=(a+1)/t*100,f=u.length>0?Math.round(c/u.length*100):0,j=s.useCallback(e=>{l||n(e)},[l]),w=s.useCallback((e=0)=>{if(null===r||l||!y)return null;const t=r===y.correct_option_id;t&&d(e=>e+1),o(!0),p(!0);const s={questionIndex:a,question:y,selectedOptionId:r,isCorrect:t,timeSpent:e};return m(e=>[...e,s]),{isCorrect:t,userAnswer:s}},[r,l,y,a]),k=s.useCallback(()=>!(a<e.length-1&&(i(e=>e+1),n(null),o(!1),p(!1),1)),[a,e.length]),N=s.useCallback(()=>(g(!0),{finalScore:c,allAnswers:u}),[c,u]),v=s.useCallback(()=>{i(0),n(null),o(!1),d(0),m([]),g(!1),p(!1)},[]);return{currentQuestionIndex:a,currentQuestion:y,selectedOption:r,isAnswered:l,score:c,userAnswers:u,showResults:x,showExplanation:h,progress:b,accuracy:f,canSubmit:null!==r&&!l,canProceed:l,handleOptionSelect:j,submitAnswer:w,nextQuestion:k,completeTest:N,resetTest:v}})(q,S),{quizSession:V,createSession:K,recordResponse:W,completeSession:X}=((e,t,a,i)=>{const[r,n]=s.useState(null),[l,o]=s.useState([]),[c,d]=s.useState([]),u=m(),p=x(),y=g(),b=h(),f=s.useCallback(async()=>{if(e&&!r&&!i)try{const s=await u.mutateAsync({userId:e.id,categoryId:t,questionCount:a});return n(s),s}catch(s){return console.error("Error creating quiz session:",s),null}},[e,r,i,u,t,a]),j=s.useCallback(t=>{!i&&r&&(o(e=>[...e,{session_id:r.id,question_id:t.questionId,selected_option_id:t.selectedOptionId,is_correct:t.isCorrect,response_order:t.responseOrder,time_spent_seconds:t.timeSpent||0}]),d(s=>[...s,{user_id:e.id,question_id:t.questionId,last_answered_correctly:t.isCorrect,last_seen_at:(new Date).toISOString()}]))},[i,r,e]),w=s.useCallback(async t=>{try{!i&&r&&(await b.mutateAsync({sessionId:r.id,userId:e.id,finalScore:t}),l.length>0&&await p.mutateAsync(l),c.length>0&&await y.mutateAsync(c))}catch(s){console.error("Error completing quiz session:",s)}},[i,r,e,b,l,c,p,y]),k=s.useCallback(()=>{n(null),o([]),d([])},[]);return{quizSession:r,createSession:f,recordResponse:j,completeSession:w,resetSession:k,isLoading:u.isLoading}})(n,T,S,O),{totalTimeLeft:Y,timeTaken:Z,formatTime:ee,getEstimatedTimeForQuestion:te,isLowTime:se,isCriticalTime:ae}=(({totalTimeInSeconds:e=1800,isActive:t=!0,onTimeUp:a})=>{const[i,r]=s.useState(e);s.useEffect(()=>{if(!t)return;const e=setInterval(()=>{r(e=>e<=1?(a?.(),0):e-1)},1e3);return()=>clearInterval(e)},[t,a]);const n=s.useCallback(()=>`${Math.floor(i/60)}:${(i%60).toString().padStart(2,"0")}`,[i]),l=e-i,o=s.useCallback(e=>0===e?0:Math.round(l/e),[l]),c=s.useCallback((e,t)=>{const s=t-e,a=i;if(0===s)return 0;const r=Math.floor(a/s);return Math.max(0,r)},[i,l]);return{totalTimeLeft:i,timeTaken:l,formatTime:n,getAvgTimePerQuestion:o,getEstimatedTimeForQuestion:c,isLowTime:i<=300,isCriticalTime:i<=60,timeLeftPercentage:i/e*100}})({totalTimeInSeconds:1800,isActive:!F,onTimeUp:()=>{ie()}});s.useEffect(()=>{n&&q.length>0&&!V&&K()},[n,q.length,V,K]);const ie=async()=>{const e=J();e&&V&&!O&&await X(e.finalScore)},re=()=>{t("/")};return A?e.jsx(w,{}):Q&&0===q.length?e.jsx(b,{error:I,onRetry:()=>window.location.reload()}):F?e.jsx(N,{score:M,questionCount:S,accuracy:P,userAnswers:R,timeTaken:Z,totalTimeLeft:Y,difficulty:v,quizSession:V,isOffline:O,questions:q,onGoHome:re}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-blue-900/20 dark:to-purple-900/20",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(k,{totalTimeLeft:Y,formatTime:ee,isLowTime:se,isCriticalTime:ae,currentQuestionIndex:L,questionCount:S,getEstimatedTimeForQuestion:te}),e.jsx(f,{current:L+1,total:S,progress:H}),e.jsx(o,{mode:"wait",children:e.jsx(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"mt-6",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden",children:e.jsx(j,{question:_,selectedOption:E,onOptionSelect:G,showFeedback:z,showExplanation:D,isAutoAdvancing:!1})})},L)}),e.jsx(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-6 flex justify-center",children:z?e.jsxs("button",{onClick:()=>{B()&&ie()},className:"flex items-center space-x-2 bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-xl font-semibold shadow-lg transform hover:scale-105 transition-all",children:[e.jsx("span",{children:L<q.length-1?"Next Question":"Finish Test"}),e.jsx(d,{className:"w-5 h-5"})]}):e.jsxs("button",{onClick:()=>{const e=Math.round((1800-Y)/S),t=U(e);t&&V&&!O&&W({questionId:_.id,selectedOptionId:t.userAnswer.selectedOptionId,isCorrect:t.isCorrect,responseOrder:L+1,timeSpent:e})},disabled:!$,className:`\n                  flex items-center space-x-2 px-8 py-3 rounded-xl font-semibold transition-all\n                  ${$?"bg-blue-600 hover:bg-blue-700 text-white shadow-lg transform hover:scale-105":"bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed"}\n                `,children:[e.jsx(c,{className:"w-5 h-5"}),e.jsx("span",{children:"Submit Answer"})]})})]})})})};export{v as default};
