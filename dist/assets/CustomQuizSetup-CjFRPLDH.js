import{r as e,j as t,m as s,u as a,aw as i}from"./vendor-0A5iGyAR.js";import{s as r}from"./index-tZRWtBsW.js";async function n(){try{const{data:e,error:t}=await r.from("question_tags").select("\n        tag_id,\n        tags!inner(type)\n      ").eq("tags.type","subject").eq("tags.is_active",!0);if(t)throw t;const s={};return e.forEach(e=>{s[e.tag_id]=(s[e.tag_id]||0)+1}),s}catch(e){return console.error("Error fetching question counts by subject:",e),{}}}async function o(){try{const{data:e,error:t}=await r.from("question_tags").select("\n        tag_id,\n        tags!inner(type)\n      ").eq("tags.type","system").eq("tags.is_active",!0);if(t)throw t;const s={};return e.forEach(e=>{s[e.tag_id]=(s[e.tag_id]||0)+1}),s}catch(e){return console.error("Error fetching question counts by system:",e),{}}}async function l(){try{const{data:e,error:t}=await r.from("question_tags").select("\n        tag_id,\n        tags!inner(type)\n      ").eq("tags.type","topic").eq("tags.is_active",!0);if(t)throw t;const s={};return e.forEach(e=>{s[e.tag_id]=(s[e.tag_id]||0)+1}),s}catch(e){return console.error("Error fetching question counts by topic:",e),{}}}async function d(e,t,s=null){return e&&t?await async function(e,t,s=null){try{if(r.from("questions").select("id",{count:"exact",head:!0}).eq("is_active",!0),e&&t){const{data:a,error:i}=await r.from("questions").select("\n          id,\n          question_tags!inner(tag_id)\n        ").eq("is_active",!0);if(i)throw i;const n=new Set,o={};return a.forEach(e=>{o[e.id]||(o[e.id]=[]),o[e.id].push(e.question_tags.tag_id)}),Object.entries(o).forEach(([a,i])=>{const r=i.includes(e),o=i.includes(t),l=!s||i.includes(s);r&&o&&l&&n.add(a)}),n.size}if(e){const{count:t,error:s}=await r.from("question_tags").select("question_id",{count:"exact",head:!0}).eq("tag_id",e);if(s)throw s;return t||0}if(t){const{count:e,error:s}=await r.from("question_tags").select("question_id",{count:"exact",head:!0}).eq("tag_id",t);if(s)throw s;return e||0}return 0}catch(a){return console.error("Error fetching question count for combination:",a),0}}(e,t,s):0}const c=()=>{const t=[{id:"mixed",name:"Mixed Questions",icon:"ðŸŽ¯",description:"Questions from all medical subjects"},{id:"cardiology",name:"Cardiology",icon:"â¤ï¸",description:"Heart and cardiovascular system"},{id:"neurology",name:"Neurology",icon:"ðŸ§ ",description:"Brain and nervous system"},{id:"respiratory",name:"Respiratory",icon:"ðŸ«",description:"Lungs and breathing system"},{id:"gastroenterology",name:"Gastroenterology",icon:"ðŸ«ƒ",description:"Digestive system"},{id:"endocrinology",name:"Endocrinology",icon:"ðŸ©º",description:"Hormones and metabolism"},{id:"infectious",name:"Infectious Disease",icon:"ðŸ¦ ",description:"Infections and immunity"},{id:"pharmacology",name:"Pharmacology",icon:"ðŸ’Š",description:"Medications and treatments"}],[s,a]=e.useState(!0),[i,c]=e.useState([]),[u,g]=e.useState([]),[m,y]=e.useState([]),[x,b]=e.useState(""),[h,f]=e.useState(""),[p,j]=e.useState(""),[v,k]=e.useState(""),[w,q]=e.useState(10),[C,N]=e.useState("timed"),[S,_]=e.useState(!0),[E,Q]=e.useState(null),[T,M]=e.useState({subjects:{},systems:{},topics:{}}),[D,z]=e.useState({}),[I,O]=e.useState(0);e.useEffect(()=>{(async()=>{try{_(!0),Q(null);const{data:e,error:s}=await r.from("tags").select("id, name, slug").eq("type","subject").eq("is_active",!0).order("order_index",{ascending:!0});if(s)throw s;c(e||[]);const a=await async function(){try{const[e,t,s]=await Promise.all([n(),o(),l()]);return{subjects:e,systems:t,topics:s}}catch(E){return console.error("Error fetching all question counts:",E),{subjects:{},systems:{},topics:{}}}}();M(a);const i={};for(const n of t)if("mixed"===n.id){const{count:e,error:t}=await r.from("questions").select("id",{count:"exact",head:!0}).eq("is_active",!0);t||(i[n.id]=e||0)}else{const{data:e,error:t}=await r.from("tags").select("id").eq("slug",n.id).eq("type","subject").eq("is_active",!0).single();if(!t&&e)i[n.id]=a.subjects[e.id]||0;else{const{data:e,error:t}=await r.from("tags").select("id").ilike("name",`%${n.name}%`).eq("type","subject").eq("is_active",!0).single();i[n.id]=!t&&e&&a.subjects[e.id]||0}}z(i)}catch(e){console.error("Error loading quiz setup data:",e),Q(e.message)}finally{_(!1)}})()},[]),e.useEffect(()=>{(async()=>{if(!x)return g([]),void f("");try{const{data:e,error:t}=await r.from("tags").select("id, name, slug").eq("type","system").eq("parent_id",x).eq("is_active",!0).order("order_index",{ascending:!0});if(t)throw t;g(e||[]),f(""),j("")}catch(e){console.error("Error loading systems:",e),Q(e.message)}})()},[x]),e.useEffect(()=>{(async()=>{if(!h)return y([]),void j("");try{const{data:e,error:t}=await r.from("tags").select("id, name, slug").eq("type","topic").eq("parent_id",h).eq("is_active",!0).order("order_index",{ascending:!0});if(t)throw t;y(e||[]),j("")}catch(e){console.error("Error loading topics:",e),Q(e.message)}})()},[h]),e.useEffect(()=>{(async()=>{if(x&&h)try{const e=await d(x,h,p||null);O(e)}catch(e){console.error("Error getting available question count:",e),O(0)}else O(0)})()},[x,h,p,v]);return{isSimpleMode:s,subjects:i,systems:u,topics:m,selectedSubject:x,selectedSystem:h,selectedTopic:p,difficulty:v,questionCount:w,timing:C,loading:S,error:E,questionCounts:T,availableQuestions:I,simpleCategories:t,simpleCategoryCounts:D,canStart:s?x&&w>0&&w<=40:x&&h&&w>0&&w<=40&&I>0,setIsSimpleMode:a,setSelectedSubject:b,setSelectedSystem:f,setSelectedTopic:j,setDifficulty:k,setQuestionCount:q,setTiming:N,createNavigationState:()=>s?{categoryId:x,categoryName:t.find(e=>e.id===x)?.name||"Mixed Questions",questionCount:w,difficulty:v||null,timePerQuestion:60,quizMode:"custom",autoAdvance:!0,showExplanations:!0}:{subjectId:x,systemId:h,topicId:p||null,difficulty:v,questionCount:w,timing:C}}},u=({isSimpleMode:e,onModeChange:s})=>t.jsx("div",{className:"flex items-center justify-center mb-6",children:t.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 rounded-lg p-1 flex",children:[t.jsx("button",{type:"button",onClick:()=>s(!0),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+(e?"bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),children:"Simple Mode"}),t.jsx("button",{type:"button",onClick:()=>s(!1),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors "+(e?"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white":"bg-white dark:bg-gray-800 text-gray-900 dark:text-white shadow-sm"),children:"Advanced Mode"})]})}),g=({simpleCategories:e,selectedSubject:a,onSubjectChange:i,questionCount:r,onQuestionCountChange:n,difficulty:o,onDifficultyChange:l,difficultyOptions:d,simpleCategoryCounts:c})=>t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block font-medium text-gray-800 dark:text-gray-200 mb-3",children:"Select Category"}),t.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.map(e=>t.jsxs(s.button,{type:"button",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>i(e.id),className:"p-4 rounded-lg border-2 text-left transition-all "+(a===e.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("span",{className:"text-2xl mr-3",children:e.icon}),t.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:e.name})]}),t.jsxs("span",{className:"text-sm font-medium text-blue-600 dark:text-blue-400",children:[c?.[e.id]||0," questions"]})]}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]},e.id))})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"questionCount",className:"block font-medium text-gray-800 dark:text-gray-200 mb-3",children:"Number of Questions"}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("input",{type:"range",min:"5",max:"40",value:r,onChange:e=>n(Number(e.target.value)),className:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"}),t.jsx("div",{className:"text-2xl font-bold text-blue-600 dark:text-blue-400 min-w-[3rem] text-center",children:r})]}),t.jsxs("div",{className:"flex justify-between text-sm text-gray-500 dark:text-gray-400 mt-2",children:[t.jsx("span",{children:"5 questions"}),t.jsx("span",{children:"40 questions"})]}),t.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["Estimated time: ",Math.round(60*r/60)," minutes"]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block font-medium text-gray-800 dark:text-gray-200 mb-3",children:"Difficulty Level"}),t.jsx("div",{className:"grid grid-cols-2 gap-3",children:d.map(e=>t.jsx(s.button,{type:"button",whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>l(e.value),className:"p-3 rounded-lg border-2 text-center transition-all "+(o===e.value?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:t.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:e.label})},e.value))})]})]}),m=({subjects:e,systems:s,topics:a,selectedSubject:i,selectedSystem:r,selectedTopic:n,onSubjectChange:o,onSystemChange:l,onTopicChange:d,difficulty:c,onDifficultyChange:u,questionCount:g,onQuestionCountChange:m,timing:y,onTimingChange:x,questionCounts:b,availableQuestions:h,difficultyOptions:f,timingOptions:p,loading:j})=>j?t.jsx("div",{className:"space-y-6",children:t.jsx("div",{className:"text-gray-500",children:"Loading options..."})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"subject",className:"block font-medium text-gray-800 dark:text-gray-200 mb-1",children:["Subject ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("select",{id:"subject",value:i,onChange:e=>o(e.target.value),className:"w-full rounded-lg border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-2",required:!0,children:[t.jsx("option",{value:"",children:"Select a subject"}),e.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",b.subjects[e.id]||0," questions)"]},e.id))]})]}),t.jsxs("div",{children:[t.jsxs("label",{htmlFor:"system",className:"block font-medium text-gray-800 dark:text-gray-200 mb-1",children:["System ",t.jsx("span",{className:"text-red-500",children:"*"})]}),t.jsxs("select",{id:"system",value:r,onChange:e=>l(e.target.value),className:"w-full rounded-lg border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-2",disabled:!i,required:!0,children:[t.jsx("option",{value:"",children:"Select a system"}),s.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",b.systems[e.id]||0," questions)"]},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"topic",className:"block font-medium text-gray-800 dark:text-gray-200 mb-1",children:"Topic (Optional)"}),t.jsxs("select",{id:"topic",value:n,onChange:e=>d(e.target.value),className:"w-full rounded-lg border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-2",disabled:!r,children:[t.jsx("option",{value:"",children:"All topics"}),a.map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",b.topics[e.id]||0," questions)"]},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"difficulty",className:"block font-medium text-gray-800 dark:text-gray-200 mb-1",children:"Difficulty"}),t.jsx("select",{id:"difficulty",value:c,onChange:e=>u(e.target.value),className:"w-full rounded-lg border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-2",children:f.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"questionCount",className:"block font-medium text-gray-800 dark:text-gray-200 mb-1",children:"Number of Questions"}),t.jsx("input",{id:"questionCount",type:"number",min:1,max:40,value:g,onChange:e=>m(Number(e.target.value)),className:"w-full rounded-lg border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-2"}),t.jsx("span",{className:"text-xs text-gray-500",children:"1â€“40 questions"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"timing",className:"block font-medium text-gray-800 dark:text-gray-200 mb-1",children:"Timing"}),t.jsx("select",{id:"timing",value:y,onChange:e=>x(e.target.value),className:"w-full rounded-lg border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-white p-2",children:p.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),i&&r&&t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{className:"text-sm font-medium text-blue-800 dark:text-blue-200",children:"Available Questions:"}),t.jsx("span",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:h})]}),0===h&&t.jsx("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:"No questions available for this combination. Try selecting different options."}),h>0&&g>h&&t.jsxs("p",{className:"text-xs text-orange-600 dark:text-orange-400 mt-1",children:["Requested ",g," questions, but only ",h," available. Quiz will include all available questions."]})]})]}),y=[{value:"",label:"Mixed"},{value:"easy",label:"Easy"},{value:"medium",label:"Medium"},{value:"hard",label:"Hard"}],x=[{value:"timed",label:"Timed (1 min/question)"},{value:"self",label:"Self-paced"}],b=()=>{const e=a(),{isSimpleMode:s,subjects:r,systems:n,topics:o,selectedSubject:l,selectedSystem:d,selectedTopic:b,difficulty:h,questionCount:f,timing:p,loading:j,error:v,questionCounts:k,availableQuestions:w,simpleCategories:q,simpleCategoryCounts:C,canStart:N,setIsSimpleMode:S,setSelectedSubject:_,setSelectedSystem:E,setSelectedTopic:Q,setDifficulty:T,setQuestionCount:M,setTiming:D,createNavigationState:z}=c();return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-emerald-50 to-teal-100 dark:from-gray-900 dark:via-green-900/20 dark:to-emerald-900/20 flex items-center justify-center p-4",children:t.jsxs("form",{onSubmit:t=>{if(t.preventDefault(),!N)return;const s=z();e("/custom-quiz",{state:s})},className:"w-full max-w-lg bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8 space-y-6","aria-label":"Custom Quiz Setup",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Custom Quiz Setup"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Select your desired filters and options to create a personalized quiz session."}),t.jsx(u,{isSimpleMode:s,onModeChange:S}),v&&t.jsx("div",{className:"text-red-600 bg-red-100 dark:bg-red-900/20 p-2 rounded",children:v}),s?t.jsx(g,{simpleCategories:q,selectedSubject:l,onSubjectChange:_,questionCount:f,onQuestionCountChange:M,difficulty:h,onDifficultyChange:T,difficultyOptions:y,simpleCategoryCounts:C}):t.jsx(m,{subjects:r,systems:n,topics:o,selectedSubject:l,selectedSystem:d,selectedTopic:b,onSubjectChange:_,onSystemChange:E,onTopicChange:Q,difficulty:h,onDifficultyChange:T,questionCount:f,onQuestionCountChange:M,timing:p,onTimingChange:D,questionCounts:k,availableQuestions:w,difficultyOptions:y,timingOptions:x,loading:j}),t.jsxs("button",{type:"submit",disabled:!N||!s&&0===w,className:"w-full flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-semibold text-white transition-all "+(N&&(s||w>0)?"bg-green-600 hover:bg-green-700 shadow-lg":"bg-gray-400 cursor-not-allowed"),children:["Start Custom Quiz",t.jsx(i,{className:"w-5 h-5"})]})]})})};export{b as default};
