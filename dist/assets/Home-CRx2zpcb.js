const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/WelcomeSection-Bmwudefw.js","assets/vendor-CVvCghmu.js","assets/HomeStats-DQ_8055W.js","assets/HomeActions-D8mB9fuv.js","assets/StudyTipsSection-CK8bTJX0.js","assets/ProgressOverview-Dpbm4Mqa.js"])))=>i.map(i=>d[i]);
import{t as e,j as s,r,l as t,L as a,_ as i}from"./vendor-CVvCghmu.js";import{s as o,l as n,u as l,L as d}from"./index-DwP4RzE3.js";import{q as c,g as u,u as m}from"./useViewTransitions-Cenlrjy5.js";const x=r.lazy(()=>i(()=>import("./WelcomeSection-Bmwudefw.js"),__vite__mapDeps([0,1]))),y=r.lazy(()=>i(()=>import("./HomeStats-DQ_8055W.js"),__vite__mapDeps([2,1]))),g=r.lazy(()=>i(()=>import("./HomeActions-D8mB9fuv.js"),__vite__mapDeps([3,1]))),_=r.lazy(()=>i(()=>import("./StudyTipsSection-CK8bTJX0.js"),__vite__mapDeps([4,1]))),p=r.lazy(()=>i(()=>import("./ProgressOverview-Dpbm4Mqa.js"),__vite__mapDeps([5,1]))),b=({isRefreshing:e,isFromCache:r})=>r||e?s.jsxs("div",{className:"fixed top-4 right-4 z-50 flex space-x-2",children:[r&&s.jsx("div",{className:"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200 px-3 py-1 rounded-full text-xs font-medium border border-yellow-200 dark:border-yellow-800",children:"ðŸ“± Offline Mode"}),e&&s.jsxs("div",{className:"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 px-3 py-1 rounded-full text-xs font-medium border border-blue-200 dark:border-blue-800 flex items-center space-x-1",children:[s.jsx(a,{className:"w-3 h-3 animate-spin"}),s.jsx("span",{children:"Syncing..."})]})]}):null,h=({error:e,onRetry:r})=>s.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 shadow-lg border border-red-200 dark:border-red-800 max-w-md w-full text-center",children:[s.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:s.jsx(t,{className:"w-8 h-8 text-red-600"})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Something went wrong"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:e?.message||"Unable to load your dashboard. Please try again."}),s.jsx("button",{onClick:r,className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-200",children:"Try Again"})]})}),f=()=>{const{user:t,profile:a}=l(),{transitionTo:i}=m(),{data:f,isLoading:j,isError:w,error:N,refetch:k}=(v=t?.id,e({queryKey:c.userActivity(v),queryFn:async()=>{if(!v)return{isNewUser:!0,userStats:{totalQuestions:0,accuracy:0,studyTime:0,currentStreak:0},recentActivity:[]};try{const{data:e,error:s}=await o.from("user_question_history").select("*").eq("user_id",v).limit(1);if(s)throw s;const r=e&&e.length>0,t=!r;let a={totalQuestions:0,accuracy:0,studyTime:0,currentStreak:0},i=[];if(r){const{data:e,error:s}=await o.rpc("get_user_stats",{p_user_id:v});if(!s&&e&&e.length>0){const s=e[0];a={totalQuestions:s.total_questions_attempted||0,accuracy:s.accuracy_percentage||0,studyTime:Math.round(2*s.total_questions_attempted/60*10)/10||0,currentStreak:0}}const{data:r,error:t}=await o.from("quiz_sessions").select("\n              *,\n              quiz_responses (\n                questions (\n                  question_text,\n                  question_tags (\n                    tags (name)\n                  )\n                )\n              )\n            ").eq("user_id",v).order("started_at",{ascending:!1}).limit(5);!t&&r&&(i=r.map(e=>{const s=e.quiz_responses?.map(e=>e.questions)||[],r=[...new Set(s.flatMap(e=>e.question_tags?.map(e=>e.tags.name)||[]))];return{id:e.id,type:e.session_type,score:e.correct_answers||0,total:e.total_questions||0,timeAgo:u(e.started_at),categories:r.slice(0,3)}}))}return{isNewUser:t,userStats:a,recentActivity:i}}catch(N){throw n.error("Error in useUserActivityQuery",{error:N.message,userId:v}),N}},staleTime:3e5,gcTime:9e5,enabled:!!v,retry:2,retryDelay:e=>Math.min(1e3*2**e,3e4)}));var v;const{isNewUser:q=!0,userStats:S={totalQuestions:0,accuracy:0,studyTime:0,currentStreak:0},recentActivity:T=[]}=f||{};return w?s.jsx(h,{error:N,onRetry:k}):s.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 pb-20 md:pb-0",children:[s.jsx(b,{isRefreshing:!1,isFromCache:!1}),s.jsx("div",{className:"px-3 md:px-6 lg:px-8 pt-2 pb-3 max-w-4xl mx-auto",children:s.jsxs(r.Suspense,{fallback:s.jsx(d,{}),children:[s.jsx(x,{user:t,profile:a,isNewUser:q}),s.jsx(y,{userStats:S,isNewUser:q,isLoading:j}),s.jsx(g,{isNewUser:q,onNavigate:i}),s.jsx(_,{}),s.jsx(p,{userStats:S,isNewUser:q})]})})]})};export{f as default};
