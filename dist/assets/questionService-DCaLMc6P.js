import{s as t}from"./index-CwYISt8q.js";class e{static getDemoQuestions(t=10){return[{id:"demo-1",question_text:"Which of the following is the most common cause of myocardial infarction?",options:[{id:"a",text:"Coronary artery thrombosis"},{id:"b",text:"Coronary artery spasm"},{id:"c",text:"Aortic stenosis"},{id:"d",text:"Pulmonary embolism"}],correct_option_id:"a",explanation:"Coronary artery thrombosis is the most common cause of myocardial infarction, typically occurring due to plaque rupture.",question_tags:[{tags:{name:"Cardiology"}}]},{id:"demo-2",question_text:"What is the normal range for adult heart rate at rest?",options:[{id:"a",text:"40-60 bpm"},{id:"b",text:"60-100 bpm"},{id:"c",text:"100-120 bpm"},{id:"d",text:"120-140 bpm"}],correct_option_id:"b",explanation:"The normal resting heart rate for adults is 60-100 beats per minute.",question_tags:[{tags:{name:"Physiology"}}]},{id:"demo-3",question_text:"Which hormone is primarily responsible for regulating blood glucose levels?",options:[{id:"a",text:"Cortisol"},{id:"b",text:"Insulin"},{id:"c",text:"Thyroxine"},{id:"d",text:"Growth hormone"}],correct_option_id:"b",explanation:"Insulin is the primary hormone responsible for regulating blood glucose levels by facilitating glucose uptake by cells.",question_tags:[{tags:{name:"Endocrinology"}}]},{id:"demo-4",question_text:"What is the most common type of lung cancer?",options:[{id:"a",text:"Small cell lung cancer"},{id:"b",text:"Adenocarcinoma"},{id:"c",text:"Squamous cell carcinoma"},{id:"d",text:"Large cell carcinoma"}],correct_option_id:"b",explanation:"Adenocarcinoma is the most common type of lung cancer, accounting for about 40% of all lung cancers.",question_tags:[{tags:{name:"Oncology"}}]},{id:"demo-5",question_text:"Which structure connects the two cerebral hemispheres?",options:[{id:"a",text:"Corpus callosum"},{id:"b",text:"Brainstem"},{id:"c",text:"Cerebellum"},{id:"d",text:"Thalamus"}],correct_option_id:"a",explanation:"The corpus callosum is the largest white matter structure in the brain that connects the two cerebral hemispheres.",question_tags:[{tags:{name:"Neurology"}}]},{id:"demo-6",question_text:"What is the first-line treatment for uncomplicated urinary tract infection in women?",options:[{id:"a",text:"Amoxicillin"},{id:"b",text:"Nitrofurantoin"},{id:"c",text:"Ciprofloxacin"},{id:"d",text:"Cephalexin"}],correct_option_id:"b",explanation:"Nitrofurantoin is often first-line treatment for uncomplicated UTIs in women due to its effectiveness and low resistance rates.",question_tags:[{tags:{name:"Infectious Disease"}}]},{id:"demo-7",question_text:"Which valve is most commonly affected in rheumatic heart disease?",options:[{id:"a",text:"Aortic valve"},{id:"b",text:"Mitral valve"},{id:"c",text:"Tricuspid valve"},{id:"d",text:"Pulmonary valve"}],correct_option_id:"b",explanation:"The mitral valve is most commonly affected in rheumatic heart disease, often leading to mitral stenosis.",question_tags:[{tags:{name:"Cardiology"}}]},{id:"demo-8",question_text:"What is the most common cause of acute pancreatitis?",options:[{id:"a",text:"Alcohol abuse"},{id:"b",text:"Gallstones"},{id:"c",text:"Medications"},{id:"d",text:"Trauma"}],correct_option_id:"b",explanation:"Gallstones are the most common cause of acute pancreatitis, followed by alcohol abuse.",question_tags:[{tags:{name:"Gastroenterology"}}]},{id:"demo-9",question_text:"Which antibody is most specific for systemic lupus erythematosus?",options:[{id:"a",text:"Anti-dsDNA"},{id:"b",text:"ANA"},{id:"c",text:"Anti-Sm"},{id:"d",text:"Anti-SSA/Ro"}],correct_option_id:"c",explanation:"Anti-Sm (Smith) antibodies are highly specific for SLE, though less sensitive than other markers.",question_tags:[{tags:{name:"Rheumatology"}}]},{id:"demo-10",question_text:"What is the most appropriate initial imaging study for suspected pulmonary embolism?",options:[{id:"a",text:"Chest X-ray"},{id:"b",text:"CT pulmonary angiogram"},{id:"c",text:"Ventilation-perfusion scan"},{id:"d",text:"Echocardiogram"}],correct_option_id:"b",explanation:"CT pulmonary angiogram (CTPA) is the most appropriate initial imaging study for suspected PE in most patients.",question_tags:[{tags:{name:"Pulmonology"}}]}].slice(0,t)}static async fetchQuestions(e,o=10){try{let r=t.from("questions").select("\n          *,\n          question_tags!inner (\n            tag_id,\n            tags (\n              name,\n              type\n            )\n          )\n        ");"mixed"!==e&&(r=r.eq("question_tags.tag_id",e));const{data:i,error:s}=await r.limit(o);return s?(console.error("Supabase error fetching questions:",s),console.warn("Falling back to demo questions due to database error"),this.getDemoQuestions(o)):i&&0!==i.length?i.sort(()=>Math.random()-.5):(console.warn("No questions found in database, using demo questions"),this.getDemoQuestions(o))}catch(r){return console.error("Error fetching questions, using demo questions:",r),this.getDemoQuestions(o)}}static async fetchCategories(){try{const{data:e,error:o}=await t.from("tag_question_counts").select("*").eq("is_active",!0).order("order_index",{ascending:!0});if(o){console.error("Error fetching from tag_question_counts view:",o);const{data:e,error:r}=await t.from("tags").select("\n            id,\n            name,\n            slug,\n            description,\n            icon_name,\n            color,\n            color_code,\n            parent_id,\n            type,\n            order_index,\n            is_active,\n            created_at,\n            updated_at\n          ").eq("is_active",!0).order("order_index",{ascending:!0});if(r)throw r;return await Promise.all((e||[]).map(async e=>{const{count:o,error:r}=await t.from("question_tags").select("*",{count:"exact",head:!0}).eq("tag_id",e.id);return r&&console.warn(`Error counting questions for tag ${e.id}:`,r),{...e,question_count:o||0}}))}return e||[]}catch(e){throw console.error("Error fetching categories:",e),e}}static async createQuizSession(e,o,r){try{const{data:i,error:s}=await t.from("quiz_sessions").insert({user_id:e,quiz_type:"practice",total_questions:r,settings:{category_id:"mixed"!==o?o:null,is_mixed:"mixed"===o}}).select().single();if(s)throw console.error("Error creating quiz session:",s),s;return i}catch(i){throw console.error("Error creating quiz session:",i),i}}static async recordQuizResponse(e,o,r,i,s=0){try{const{error:n}=await t.from("quiz_responses").insert({session_id:e,question_id:o,selected_option_id:r,is_correct:i,response_order:s,time_spent_seconds:0});if(n)throw console.error("Error recording quiz response:",n),n}catch(n){throw console.error("Error recording quiz response:",n),n}}static async updateUserQuestionHistory(e,o,r,i){try{const{error:r}=await t.from("user_question_history").upsert({user_id:e,question_id:o,last_answered_correctly:i,last_seen_at:(new Date).toISOString()},{onConflict:"user_id,question_id"});if(r)throw console.error("Error updating user question history:",r),r}catch(s){throw console.error("Error updating user question history:",s),s}}static async completeQuizSession(e,o,r){try{const{error:i}=await t.from("quiz_sessions").update({correct_answers:r,completed_at:(new Date).toISOString()}).eq("id",e).eq("user_id",o);if(i)throw console.error("Error completing quiz session:",i),i}catch(i){throw console.error("Error completing quiz session:",i),i}}static async getUserProgress(e,o){if(!e||!o)return 0;try{const{data:r,error:i}=await t.from("user_question_history").select("\n          last_answered_correctly,\n          questions!inner (\n            question_tags!inner (\n              tag_id\n            )\n          )\n        ").eq("user_id",e).eq("questions.question_tags.tag_id",o);if(i)return console.warn("Error getting user progress:",i),0;if(!r||0===r.length)return 0;const s=r.filter(t=>t.last_answered_correctly).length,n=r.length;return Math.round(s/n*100)}catch(r){return console.error("Error getting user progress:",r),0}}static async getProgressMap(e){if(!e)return{};try{const{data:o,error:r}=await t.from("user_question_history").select("\n          last_answered_correctly,\n          questions!inner (\n            id,\n            question_tags!inner( tag_id )\n          )\n        ").eq("user_id",e);if(r)return console.warn("Error fetching progress map:",r),{};if(!o||0===o.length)return{};const i={};o.forEach(t=>{t.questions?.question_tags?.forEach(({tag_id:e})=>{i[e]||(i[e]={correct:0,total:0}),i[e].total+=1,t.last_answered_correctly&&(i[e].correct+=1)})});const s={};return Object.entries(i).forEach(([t,{correct:e,total:o}])=>{s[t]=Math.round(e/o*100)}),s}catch(o){return console.error("Error getting progress map:",o),{}}}static async testConnection(){try{const{data:e,error:o}=await t.from("tags").select("count(*)").limit(1);return o?{success:!1,error:o.message}:{success:!0,data:e}}catch(e){return{success:!1,error:e.message}}}}export{e as Q};
