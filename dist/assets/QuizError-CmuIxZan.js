import{l as e,s}from"./index-Cnu_oIsx.js";import{j as t,w as a,x as r,as as n,m as i,i as o,a_ as l,a$ as c,u as d,k as u,b0 as x,at as m,H as g,aA as h,av as p,b1 as y}from"./vendor-CVvCghmu.js";const f={quick:"quick",timed:"timed",custom:"self_paced",block:"block",self_paced:"self_paced",learn_module:"learn_module"};async function N(t){const{userId:a,sessionType:r="self_paced",totalQuestions:n,categoryName:i=null,timePerQuestion:o=null,autoAdvance:l=!1,showExplanations:c=!0,settings:d={}}=t;e.info("Creating quiz session",{userId:a,sessionType:r,totalQuestions:n,categoryName:i,timePerQuestion:o,autoAdvance:l,showExplanations:c});const u=f[r]||"self_paced",x={user_id:a,session_type:u,total_questions:n,started_at:(new Date).toISOString(),category_name:i,settings:{timePerQuestion:o,autoAdvance:l,showExplanations:c,...d}},{data:m,error:g}=await s.from("quiz_sessions").insert(x).select().single();if(g)throw e.error("Error creating quiz session",{error:g,sessionData:x}),new Error(`CREATE_SESSION_ERROR: ${g.message}`);return e.success("Quiz session created successfully",{sessionId:m.id,sessionType:u,totalQuestions:n}),m}async function b(t,a){const{correctAnswers:r,totalTimeSeconds:n,pointsEarned:i=0,completed:o=!0}=a;e.info("Completing quiz session",{sessionId:t,correctAnswers:r,totalTimeSeconds:n,pointsEarned:i,completed:o});const l={correct_answers:r,completed_at:(new Date).toISOString(),total_time_seconds:n,points_earned:i,is_completed:o},{data:c,error:d}=await s.from("quiz_sessions").update(l).eq("id",t).select().single();if(d)throw e.error("Error completing quiz session",{error:d,sessionId:t,updateData:l}),new Error(`COMPLETE_SESSION_ERROR: ${d.message}`);return e.success("Quiz session completed successfully",{sessionId:c.id,correctAnswers:r,totalTimeSeconds:n,pointsEarned:i}),c}const j=({current:e,total:s,progress:c,score:d=0,accuracy:u=0,averageTime:x=0,showDetailed:m=!0,size:g="normal"})=>{const h=Math.max(0,Math.min(100,e/s*100)),p=Math.max(0,Math.min(100,u)),y=s-e,f=()=>p>=80?"text-green-600 dark:text-green-400":p>=60?"text-blue-600 dark:text-blue-400":p>=40?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400",N=(()=>{switch(g){case"compact":return{container:"py-2",progressHeight:"h-2",text:"text-sm",icons:"w-4 h-4",spacing:"space-y-1"};case"detailed":return{container:"py-6",progressHeight:"h-4",text:"text-base",icons:"w-5 h-5",spacing:"space-y-4"};default:return{container:"py-4",progressHeight:"h-3",text:"text-sm",icons:"w-4 h-4",spacing:"space-y-2"}}})();return t.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 ${N.container}`,children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-3",children:[t.jsx("h3",{className:`font-semibold text-gray-900 dark:text-white ${N.text}`,children:"Progress"}),t.jsxs("span",{className:`font-bold ${N.text} text-blue-600 dark:text-blue-400`,children:[e," / ",s]})]}),m&&t.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(a,{className:"w-4 h-4 text-purple-500"}),t.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:["Score: ",t.jsx("span",{className:"text-purple-600 dark:text-purple-400",children:d})]})]}),u>0&&t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(r,{className:"w-4 h-4 text-green-500"}),t.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:["Accuracy: ",t.jsxs("span",{className:f(),children:[Math.round(p),"%"]})]})]}),x>0&&t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx(n,{className:"w-4 h-4 text-orange-500"}),t.jsxs("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:["Avg: ",t.jsxs("span",{className:"text-orange-600 dark:text-orange-400",children:[Math.round(x),"s"]})]})]})]})]}),t.jsxs("div",{className:`relative bg-gray-200 dark:bg-gray-700 rounded-full ${N.progressHeight} overflow-hidden mb-4`,children:[t.jsxs(i.div,{className:`${N.progressHeight} bg-gradient-to-r ${p>=80?"from-green-500 to-emerald-600":p>=60?"from-blue-500 to-blue-600":p>=40?"from-yellow-500 to-orange-500":"from-orange-500 to-red-500"} rounded-full relative`,initial:{width:0},animate:{width:`${h}%`},transition:{duration:.8,ease:"easeOut"},children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent animate-pulse"}),h>15&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-end pr-2",children:t.jsxs("span",{className:"text-xs font-bold text-white drop-shadow-sm",children:[Math.round(h),"%"]})})]}),t.jsx(i.div,{className:"absolute top-0 h-full w-1 bg-white shadow-lg",initial:{left:0},animate:{left:`${h}%`},transition:{duration:.8,ease:"easeOut"},style:{transform:"translateX(-50%)"}})]}),s<=20&&"compact"!==g&&t.jsx("div",{className:"mb-4",children:t.jsx("div",{className:"flex items-center justify-center space-x-2 flex-wrap gap-1 pb-6",children:Array.from({length:s},(s,a)=>{const r=a+1,n=r<e,c=r===e;return t.jsxs(i.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.05*a,duration:.3},className:"relative",children:[n?t.jsx(i.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.1},className:"flex items-center justify-center",children:t.jsx(o,{className:`${N.icons} text-green-500`})}):c?t.jsx(i.div,{animate:{scale:[1,1.2,1],rotate:[0,180,360]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},className:"flex items-center justify-center",children:t.jsx(l,{className:`${N.icons} text-blue-500 fill-current`})}):t.jsx(l,{className:`${N.icons} text-gray-300 dark:text-gray-600`}),t.jsx("div",{className:"absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-xs text-gray-500 dark:text-gray-400",children:r})]},a)})})}),m&&"detailed"===g&&t.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:[t.jsx("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:y}),t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Remaining"})]}),t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3",children:[t.jsx("div",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:d}),t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Correct"})]}),t.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-lg p-3",children:[t.jsxs("div",{className:`text-lg font-bold ${f()}`,children:[Math.round(p),"%"]}),t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Accuracy"})]}),t.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-3",children:[t.jsx("div",{className:"text-lg font-bold text-orange-600 dark:text-orange-400",children:x>0?`${Math.round(x)}s`:"--"}),t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Avg Time"})]})]}),m&&"compact"!==g&&t.jsx("div",{className:"mt-4 text-center",children:t.jsx(i.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:1},className:"text-sm text-gray-600 dark:text-gray-400",children:h>=75?t.jsx("span",{className:"text-green-600 dark:text-green-400 font-medium",children:"ðŸŽ‰ Almost there! You're doing great!"}):h>=50?t.jsx("span",{className:"text-blue-600 dark:text-blue-400 font-medium",children:"ðŸš€ Halfway done! Keep up the momentum!"}):h>=25?t.jsx("span",{className:"text-purple-600 dark:text-purple-400 font-medium",children:"ðŸ’ª Good progress! Stay focused!"}):t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"ðŸŒŸ Just getting started! You've got this!"})})})]})},w=({isFetching:e})=>t.jsxs("div",{className:"flex flex-col justify-center items-center h-screen",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"}),t.jsx("p",{className:"text-gray-600",children:"Loading quiz questions..."}),e&&t.jsxs("p",{className:"text-sm text-gray-500",children:["Fetching latest questions ",t.jsx(c,{size:16,className:"inline-block animate-pulse"})]})]}),k=e=>e?"NO_QUESTIONS"===e.code?e.message||"No questions found for your selected category or difficulty.":"NO_CONFIG"===e.code?"Quiz configuration is missing. Please try starting the quiz again.":"FETCH_ERROR"===e.code?e.message||"Failed to load questions from the database.":e.message?.includes("FETCH_QUESTIONS_ERROR")?"Failed to fetch quiz questions. Please try again or adjust your filters.":e.message?.includes("SESSION_CREATION_ERROR")?"Failed to create a quiz session. Please try starting the quiz again.":e.message?.includes("RESPONSE_RECORDING_ERROR")?"Failed to record your response. Please continue to the next question.":e.message?.includes("SESSION_COMPLETION_ERROR")?"Failed to complete the quiz session. Your progress may not be saved.":"ERR_NETWORK"===e.code||e.message?.toLowerCase().includes("network")?"Network error: Please check your internet connection and try again.":"ERR_SERVER"===e.code||500===e.status?"Server error: Please try again later.":406===e.status?"Not Acceptable: The server could not process your request. Please contact support if this persists.":401===e.status||403===e.status?"You are not authorized to access this quiz. Please log in or check your permissions.":e.message||"There was a problem loading the quiz questions.":"There was a problem loading the quiz questions.",v=({error:e,onRetry:s,categoryId:a,questionCount:r,getOfflineData:n,showOfflineOption:i=!0})=>{const o=d(),l=i?n?.(a,r):null,c=(e=>"NO_QUESTIONS"===e.code?h:"NO_CONFIG"===e.code?p:"FETCH_ERROR"===e.code?u:y)(e),f=((e,s,t)=>{const a=[];return"NO_QUESTIONS"===e.code?(a.push("Try selecting a different difficulty level"),a.push("Choose a different category"),a.push("Use mixed categories for more options"),t>10&&a.push(`Try with fewer questions (${Math.max(5,t-5)})`)):"FETCH_ERROR"===e.code||e.message?.includes("FETCH_QUESTIONS_ERROR")?(a.push("Check your internet connection"),a.push("Try again in a few moments"),a.push("Contact support if the problem persists")):"NO_CONFIG"===e.code||e.message?.includes("SESSION_CREATION_ERROR")?(a.push("Go back to quiz selection"),a.push("Try starting the quiz again")):e.message?.includes("RESPONSE_RECORDING_ERROR")||e.message?.includes("SESSION_COMPLETION_ERROR")?(a.push("Continue with the quiz if possible"),a.push("Your progress may not be saved"),a.push("Contact support if issues persist")):(a.push("Try refreshing the page"),a.push("Check your internet connection"),a.push("Go back to quiz selection")),a})(e,0,r);return t.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center p-4",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-8 shadow-lg border border-gray-200 dark:border-gray-700 max-w-lg w-full text-center",children:[t.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 rounded-full w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:t.jsx(c,{className:"w-8 h-8 text-red-600"})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Unable to Load Quiz"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:k(e)}),e&&(e.code||e.details)&&t.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4 mb-6 text-left",children:[t.jsxs("h4",{className:"font-medium text-yellow-800 dark:text-yellow-200 mb-2 flex items-center",children:[t.jsx(u,{className:"w-4 h-4 mr-2"}),"What went wrong:"]}),t.jsx("ul",{className:"text-sm text-yellow-700 dark:text-yellow-300 space-y-1",children:f.map((e,s)=>t.jsxs("li",{className:"flex items-start",children:[t.jsx("span",{className:"text-yellow-500 mr-2",children:"â€¢"}),e]},s))})]}),t.jsxs("div",{className:"space-y-3",children:[s&&t.jsxs("button",{onClick:s,className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-200 flex items-center justify-center space-x-2",children:[t.jsx(x,{className:"w-4 h-4"}),t.jsx("span",{children:"Try Again"})]}),l&&l.length>0&&t.jsxs("button",{onClick:()=>window.location.reload(),className:"w-full bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors duration-200 flex items-center justify-center space-x-2",children:[t.jsx(m,{className:"w-4 h-4"}),t.jsxs("span",{children:["Use Offline Questions (",l.length,")"]})]}),t.jsxs("button",{onClick:()=>{o("/quick-quiz",{state:{categoryId:"mixed",categoryName:"Mixed Categories",questionCount:Math.min(r||10,10),quizType:"quick"}})},className:"w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 transition-colors duration-200 flex items-center justify-center space-x-2",children:[t.jsx(m,{className:"w-4 h-4"}),t.jsx("span",{children:"Try Mixed Quiz"})]}),t.jsx("button",{onClick:()=>o("/quiz"),className:"w-full bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-gray-700 transition-colors duration-200",children:"Back to Categories"}),t.jsxs("button",{onClick:()=>o("/"),className:"w-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 px-6 py-3 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors duration-200 flex items-center justify-center space-x-2",children:[t.jsx(g,{className:"w-4 h-4"}),t.jsx("span",{children:"Go Home"})]})]}),!1]})})};export{w as Q,v as a,j as b,N as c,b as d};
