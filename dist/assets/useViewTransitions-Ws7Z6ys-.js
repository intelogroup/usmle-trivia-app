import{aw as t,u as e,r}from"./vendor-BncJ-8MG.js";import{s as n,l as o}from"./index-CvtoYzRs.js";const a=t=>["userActivity",t],s=t=>["categories","withProgress",t],i=e=>t({queryKey:a(e),queryFn:async()=>{if(!e)return{isNewUser:!0,userStats:{totalQuestions:0,accuracy:0,studyTime:0,currentStreak:0},recentActivity:[]};try{const{data:t,error:r}=await n.from("user_question_history").select("*").eq("user_id",e).limit(1);if(r)throw r;const o=t&&t.length>0,a=!o;let s={totalQuestions:0,accuracy:0,studyTime:0,currentStreak:0},i=[];if(o){const{data:t,error:r}=await n.rpc("get_user_stats",{p_user_id:e});if(!r&&t&&t.length>0){const e=t[0];s={totalQuestions:e.total_questions_attempted||0,accuracy:e.accuracy_percentage||0,studyTime:Math.round(2*e.total_questions_attempted/60*10)/10||0,currentStreak:0}}const{data:o,error:a}=await n.from("quiz_sessions").select("\n              *,\n              quiz_responses (\n                questions (\n                  question_tags (\n                    tags (name)\n                  )\n                )\n              )\n            ").eq("user_id",e).not("completed_at","is",null).order("completed_at",{ascending:!1}).limit(4);!a&&o&&(i=o.map(t=>{const e=(t.quiz_responses?.flatMap(t=>t.questions?.question_tags?.map(t=>t.tags.name)||[])||[])[0]||"General";return{category:e,score:`${t.correct_answers||0}/${t.total_questions||0}`,time:u(t.completed_at),color:l(e)}}))}return{isNewUser:a,userStats:s,recentActivity:i}}catch(t){throw o.error("Error fetching user activity:",t),t}},staleTime:12e4,gcTime:6e5,retry:2,enabled:!!e}),c=e=>t({queryKey:s(e),queryFn:async()=>{try{const{data:t,error:r}=await n.from("tags").select("\n            id,\n            name,\n            slug,\n            description,\n            icon_name,\n            color,\n            color_code,\n            type,\n            order_index,\n            is_active,\n            parent_id\n          ").eq("is_active",!0).order("order_index",{ascending:!0}).order("name",{ascending:!0});if(r)throw r;if(!e)return t.map(t=>({...t,title:t.name,questionCount:0,progress:0,accuracy:0}));return await Promise.all(t.map(async t=>{try{const{count:r,error:a}=await n.from("questions").select("id",{count:"exact",head:!0}).eq("is_active",!0).limit(10);a&&o.warn(`Error getting question count for ${t.name}:`,a);let s=0,i=0;if(r>0){const{data:o,error:a}=await n.from("user_question_history").select("\n                    is_correct,\n                    questions!inner (\n                      question_tags!inner (\n                        tag_id\n                      )\n                    )\n                  ").eq("user_id",e).eq("questions.question_tags.tag_id",t.id);if(!a&&o&&o.length>0){const t=o.filter(t=>t.is_correct).length,e=o.length;s=Math.round(e/r*100),i=Math.round(t/e*100)}}return{...t,title:t.name,questionCount:r||0,progress:Math.min(s,100),accuracy:Math.min(i,100),icon:t.icon_name,color:t.color_code||t.color}}catch(r){return o.error(`Error processing category ${t.name}:`,r),{...t,title:t.name,questionCount:0,progress:0,accuracy:0,icon:t.icon_name,color:t.color_code||t.color}}}))}catch(t){throw o.error("Error fetching categories:",t),t}},staleTime:3e5,gcTime:9e5,retry:2,enabled:!0}),u=t=>{const e=new Date(t),r=new Date,n=Math.floor((r-e)/36e5);if(n<24)return`${n}h ago`;return`${Math.floor(n/24)}d ago`},l=t=>({Cardiology:"text-red-500",Neurology:"text-purple-500",Pharmacology:"text-green-500",Anatomy:"text-blue-500",Pathology:"text-orange-500",Biochemistry:"text-teal-500",Physiology:"text-indigo-500",General:"text-gray-500"}[t]||"text-gray-500"),m=()=>{const t=e(),n=r.useCallback((e,r={})=>{const{replace:n=!1,state:o=null,transitionName:a="page-transition",duration:s=300}=r;if(!document.startViewTransition)return void t(e,{replace:n,state:o});document.documentElement.classList.add(`transition-${a}`);const i=document.startViewTransition(()=>{t(e,{replace:n,state:o})});return i.finished.finally(()=>{document.documentElement.classList.remove(`transition-${a}`)}),i},[t]),o=r.useCallback((t,e,r={})=>n("/quiz",{state:{categoryId:t,categoryName:e,...r},transitionName:"quiz-enter"}),[n]),a=r.useCallback(()=>n("/",{transitionName:"home-enter"}),[n]),s=r.useCallback(()=>n("/profile",{transitionName:"profile-enter"}),[n]);return{transitionTo:n,transitionToQuiz:o,transitionToHome:a,transitionToProfile:s,isSupported:!!document.startViewTransition}};export{i as a,c as b,m as u};
