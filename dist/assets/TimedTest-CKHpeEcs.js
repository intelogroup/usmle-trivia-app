import{u as e,b as t,r as s,j as a,s as i,c as r,x as n,n as l}from"./vendor-react-BiMcuLH7.js";import{u as d}from"./index-DH4Rn4SV.js";import{u as o,a as c,b as x,c as m,d as u,e as h,Q as y,f as g,g as p,h as f}from"./QuizError-BaeSY76C.js";import{u as j,v as b}from"./vendor-Dcu_KtFL.js";import"./questionService-ObTb5fh1.js";const w=()=>{const w=e(),v=t(),{user:N}=d(),{difficulty:k=null}=v.state||{},S="mixed",_=20,q=1800,[I,A]=s.useState(0),[M,Q]=s.useState(null),[T,C]=s.useState(!1),[E,O]=s.useState(0),[z,R]=s.useState(null),[D,B]=s.useState([]),[F,H]=s.useState(!1),[L,P]=s.useState(q),[V,$]=s.useState(!1),{getOfflineData:G}=o(),{data:J=[],isLoading:K,error:U,isError:W}=c(S,_,k,{enabled:!!N,retry:(e,t)=>!G(S,_)&&e<2}),X=s.useMemo(()=>W&&J.length>0,[W,J.length]),Y=x(),Z=m(),ee=u(),te=h(),[se,ae]=s.useState([]),[ie,re]=s.useState([]);s.useEffect(()=>{(async()=>{if(N&&J.length>0&&!z)try{const e=await Y.mutateAsync({userId:N.id,categoryId:S,questionCount:_});R(e)}catch(e){console.error("Error creating quiz session:",e)}})()},[N,J.length,z,Y]),s.useEffect(()=>{if(F)return;const e=setInterval(()=>{P(e=>e<=1?0:e-1)},1e3);return()=>clearInterval(e)},[F]),s.useEffect(()=>{0!==L||F||ne()},[L,F]);const ne=async()=>{H(!0);try{z&&!X&&(await te.mutateAsync({sessionId:z.id,userId:N.id,finalScore:E}),se.length>0&&await Z.mutateAsync(se),ie.length>0&&await ee.mutateAsync(ie))}catch(e){console.error("Error completing quiz:",e)}},le=()=>{w("/")};if(K)return a.jsx(y,{});if(W&&0===J.length)return a.jsx(g,{error:U,onRetry:()=>window.location.reload()});if(F){const e=Math.round(E/_*100),t=q-L,s=Math.round(t/_);return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-blue-900/20 dark:to-purple-900/20",children:a.jsx("div",{className:"container mx-auto px-4 py-8",children:a.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-4xl mx-auto",children:[a.jsxs("div",{className:"text-center mb-8",children:[a.jsx(j.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-blue-600 text-white mb-4",children:a.jsx(i,{className:"w-8 h-8"})}),a.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Timed Test Complete!"}),a.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Time taken: ",Math.floor(t/60),":",(t%60).toString().padStart(2,"0")]})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[a.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-white dark:bg-gray-800 rounded-xl p-6 text-center shadow-lg",children:[a.jsxs("div",{className:"text-4xl font-bold text-blue-600 mb-2",children:[E,"/",_]}),a.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"Questions Correct"})]}),a.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-white dark:bg-gray-800 rounded-xl p-6 text-center shadow-lg",children:[a.jsxs("div",{className:"text-4xl font-bold text-purple-600 mb-2",children:[e,"%"]}),a.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"Accuracy"})]}),a.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-white dark:bg-gray-800 rounded-xl p-6 text-center shadow-lg",children:[a.jsxs("div",{className:"text-4xl font-bold text-green-600 mb-2",children:[s,"s"]}),a.jsx("div",{className:"text-gray-600 dark:text-gray-300",children:"Avg Time/Question"})]})]}),a.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},className:"bg-white dark:bg-gray-800 rounded-xl p-6 mb-8 shadow-lg",children:[a.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Performance Summary"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Questions Answered"}),a.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:[D.length,"/",_]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Time Remaining"}),a.jsxs("span",{className:"font-semibold text-gray-900 dark:text-white",children:[Math.floor(L/60),":",(L%60).toString().padStart(2,"0")]})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Difficulty"}),a.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:k||"Mixed"})]})]})]}),a.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"flex flex-col sm:flex-row gap-4 justify-center",children:[a.jsx("button",{onClick:le,className:"flex items-center justify-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-xl transition-colors",children:a.jsx("span",{children:"Back to Home"})}),a.jsxs("button",{onClick:()=>w("/results",{state:{score:E,totalQuestions:_,questions:J,quizResponses:D,quizType:"timed-test",sessionId:z?.id,isOffline:X}}),className:"flex items-center justify-center space-x-2 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-xl transition-colors",children:[a.jsx(r,{className:"w-5 h-5"}),a.jsx("span",{children:"View Detailed Review"})]})]})]})})})}const de=J[I],oe=(I+1)/_*100,ce=90-Math.round((q-L)/(I+1));return a.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-blue-900/20 dark:to-purple-900/20",children:a.jsx("div",{className:"container mx-auto px-4 py-8",children:a.jsxs("div",{className:"max-w-4xl mx-auto",children:[a.jsxs(j.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"flex justify-between items-center mb-6 bg-white dark:bg-gray-800 rounded-xl p-4 shadow-lg",children:[a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(i,{className:"w-6 h-6 text-blue-600"}),a.jsxs("div",{children:[a.jsxs("div",{className:"text-2xl font-bold text-gray-900 dark:text-white tabular-nums",children:[Math.floor(L/60),":",(L%60).toString().padStart(2,"0")]}),a.jsx("div",{className:"text-xs text-gray-500",children:"Total Time Remaining"})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Question ",I+1," of ",_]}),a.jsxs("div",{className:"text-xs text-gray-500",children:["~",ce>0?ce:0,"s for this question"]})]})]}),a.jsx(p,{current:I+1,total:_,progress:oe}),a.jsx(b,{mode:"wait",children:a.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"mt-6",children:a.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden",children:a.jsx(f,{currentQuestion:de,selectedOption:M,handleOptionSelect:e=>{T||Q(e)},showExplanations:V,isAnswered:T})})},I)}),a.jsx(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-6 flex justify-center",children:T?a.jsxs("button",{onClick:()=>{I<J.length-1?(A(I+1),Q(null),C(!1),$(!1)):ne()},className:"flex items-center space-x-2 bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-xl font-semibold shadow-lg transform hover:scale-105 transition-all",children:[a.jsx("span",{children:I<J.length-1?"Next Question":"Finish Test"}),a.jsx(l,{className:"w-5 h-5"})]}):a.jsxs("button",{onClick:()=>{if(null===M||T)return;const e=J[I],t=M===e.correct_option_id;t&&O(e=>e+1),C(!0),$(!0);const s={questionIndex:I,question:e,selectedOptionId:M,isCorrect:t,timeSpent:Math.round((q-L)/_)};B(e=>[...e,s]),z&&!X&&(ae(a=>[...a,{session_id:z.id,question_id:e.id,selected_option_id:M,is_correct:t,response_order:I+1,time_spent_seconds:s.timeSpent}]),re(s=>[...s,{user_id:N.id,question_id:e.id,last_answered_correctly:t,last_seen_at:(new Date).toISOString()}]))},disabled:null===M,className:`\n                  flex items-center space-x-2 px-8 py-3 rounded-xl font-semibold transition-all\n                  ${null!==M?"bg-blue-600 hover:bg-blue-700 text-white shadow-lg transform hover:scale-105":"bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed"}\n                `,children:[a.jsx(n,{className:"w-5 h-5"}),a.jsx("span",{children:"Submit Answer"})]})})]})})})};export{w as default};
