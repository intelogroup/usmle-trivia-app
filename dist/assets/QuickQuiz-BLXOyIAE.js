import{u as e,j as t,v as s,W as a,w as r,q as i,r as n,b as l,T as o,Z as d,p as c,x,y as m,z as u,l as g}from"./vendor-react-BiMcuLH7.js";import{u as h}from"./index-DH4Rn4SV.js";import{u as p,a as b,b as y,c as f,d as j,e as N,Q as v,f as w,g as k,h as _}from"./QuizError-BaeSY76C.js";import{v as S,u as q}from"./vendor-Dcu_KtFL.js";import"./questionService-ObTb5fh1.js";const C=({categoryName:n,currentQuestionIndex:l,totalQuestions:o,score:d,isOffline:c,isFetching:x,timeLeft:m,isTimed:u})=>{const g=e();return t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("button",{onClick:()=>g(-1),className:"p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700",children:t.jsx(s,{size:20})}),t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"text-base font-bold flex items-center gap-2",children:[n||"Quiz",c&&t.jsx("div",{className:"flex items-center text-orange-500",title:"Using offline questions",children:t.jsx(a,{size:16})}),x&&t.jsx("div",{className:"flex items-center text-blue-500",title:"Updating questions",children:t.jsx(r,{size:16,className:"animate-pulse"})})]}),t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Question ",l+1," / ",o]})]}),t.jsx("div",{className:"text-right",children:u?t.jsxs("div",{className:"flex items-center gap-1 text-red-500",children:[t.jsx(i,{size:16}),t.jsx("div",{className:"text-base font-bold",children:(e=>{if(null===e)return"--:--";const t=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`})(m)})]}):t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Score"}),t.jsxs("div",{className:"text-base font-bold",children:[d,"/",o]})]})})]})},Q=({trigger:e,duration:s=3e3})=>{const[a,r]=n.useState(!1);n.useEffect(()=>{if(e){r(!0);const e=setTimeout(()=>r(!1),s);return()=>clearTimeout(e)}},[e,s]);const i=Array.from({length:50},(e,t)=>({id:t,left:100*Math.random(),delay:2*Math.random(),duration:2+2*Math.random(),color:["bg-red-500","bg-blue-500","bg-green-500","bg-yellow-500","bg-purple-500","bg-pink-500"][Math.floor(6*Math.random())]}));return t.jsx(S,{children:a&&t.jsx("div",{className:"fixed inset-0 pointer-events-none z-50 overflow-hidden",children:i.map(e=>t.jsx(q.div,{className:`absolute w-2 h-2 ${e.color} rounded-sm`,style:{left:`${e.left}%`,top:"-10px"},initial:{y:-20,rotate:0,opacity:1},animate:{y:window.innerHeight+20,rotate:360,opacity:0},transition:{duration:e.duration,delay:e.delay,ease:"easeIn"}},e.id))})})},z=()=>{const s=e(),a=l(),{user:r}=h(),{categoryId:z="mixed",categoryName:I="Quick Quiz",questionCount:$=10,difficulty:O=null,quizType:E="quick",isAutoAdvance:M=!0,showExplanations:T=!1,isTimed:A=!1,isBlitzMode:L=!1}=a.state||{},[D,U]=n.useState(0),[R,B]=n.useState(null),[F,G]=n.useState(0),[H,W]=n.useState(null),[Y,J]=n.useState(!1),[K,P]=n.useState(!1),[Z,V]=n.useState([]),[X,ee]=n.useState(!1),[te,se]=n.useState(60),[ae,re]=n.useState(0),{getOfflineData:ie}=p(),{data:ne=[],isLoading:le,error:oe,isError:de}=b(z,$,O,{enabled:!!r,retry:(e,t)=>!ie(z,$)&&e<2}),ce=n.useMemo(()=>de&&ne.length>0,[de,ne.length]),xe=y(),me=f(),ue=j(),ge=N(),[he,pe]=n.useState([]),[be,ye]=n.useState([]);n.useEffect(()=>{(async()=>{if(r&&ne.length>0&&!H)try{const e=await xe.mutateAsync({userId:r.id,categoryId:z,questionCount:$});W(e)}catch(e){console.error("Error creating quiz session:",e)}})()},[r,ne.length,H,xe]),n.useEffect(()=>{if(X||K)return;const e=setInterval(()=>{se(e=>e<=1?(fe(),60):e-1)},1e3);return()=>clearInterval(e)},[D,X,K,ae]);const fe=()=>{if(null===R&&!Y){const e=ne[D],t={questionIndex:D,question:e,selectedOptionId:null,isCorrect:!1,timedOut:!0};V(e=>[...e,t]),H&&!ce&&(pe(t=>[...t,{session_id:H.id,question_id:e.id,selected_option_id:null,is_correct:!1,response_order:D+1,time_spent_seconds:60}]),ye(t=>[...t,{user_id:r.id,question_id:e.id,last_answered_correctly:!1,last_seen_at:(new Date).toISOString()}])),J(!0),setTimeout(()=>{D<ne.length-1?(U(D+1),B(null),J(!1),se(60),re(e=>e+1)):je()},500)}},je=async()=>{P(!0);let e=[...Z];if(null!==R&&!Z.find(e=>e.questionIndex===D)){const t=ne[D],s=R===t.correct_option_id;e.push({questionIndex:D,question:t,selectedOptionId:R,isCorrect:s})}const t=e.filter(e=>e.isCorrect).length;G(t),V(e);try{H&&!ce&&(await ge.mutateAsync({sessionId:H.id,userId:r.id,finalScore:t}),he.length>0&&await me.mutateAsync(he),be.length>0&&await ue.mutateAsync(be))}catch(s){console.error("Error completing quiz:",s)}ee(!0)},Ne=()=>{U(0),B(null),G(0),V([]),P(!1),ee(!1),J(!1),pe([]),ye([]),W(null),se(60),re(e=>e+1)},ve=()=>{s("/")};if(le)return t.jsx(v,{});if(de&&0===ne.length)return t.jsx(w,{error:oe,onRetry:()=>window.location.reload()});if(X){const e=Math.round(F/$*100),s=(()=>e>=80?{grade:"A",color:"text-green-600",bgColor:"bg-green-100",message:"Excellent!"}:e>=70?{grade:"B",color:"text-blue-600",bgColor:"bg-blue-100",message:"Good job!"}:e>=60?{grade:"C",color:"text-yellow-600",bgColor:"bg-yellow-100",message:"Not bad!"}:{grade:"D",color:"text-red-600",bgColor:"bg-red-100",message:"Keep practicing!"})();return t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100 dark:from-gray-900 dark:via-purple-900/20 dark:to-indigo-900/20",children:[t.jsx(Q,{trigger:e>=80,duration:4e3}),t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsxs(q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-4xl mx-auto",children:[t.jsxs("div",{className:"text-center mb-8",children:[t.jsx(q.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"inline-flex items-center justify-center w-16 h-16 rounded-full text-white mb-4 "+(e>=80?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-purple-600"),children:e>=80?t.jsx(o,{className:"w-8 h-8"}):t.jsx(d,{className:"w-8 h-8"})}),t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white mb-2",children:e>=80?"ðŸŽ‰ Outstanding! ðŸŽ‰":"Quick Quiz Complete!"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:e>=80?"You absolutely crushed it!":s.message}),e>=80&&t.jsx(q.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.8},className:"text-sm text-purple-600 dark:text-purple-400 mt-2",children:"ðŸŒŸ You're ready for the real thing! ðŸŒŸ"})]}),t.jsx(q.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.3},className:`${s.bgColor} rounded-2xl p-4 sm:p-8 mb-8 text-center`,children:t.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center sm:space-x-6 space-y-4 sm:space-y-0",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`text-4xl sm:text-6xl font-bold ${s.color} mb-1 sm:mb-2`,children:F}),t.jsxs("div",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-300",children:["out of ",$]})]}),t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:`text-4xl sm:text-6xl font-bold ${s.color} mb-1 sm:mb-2`,children:[e,"%"]}),t.jsx("div",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-300",children:"accuracy"})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:`text-4xl sm:text-6xl font-bold ${s.color} mb-1 sm:mb-2`,children:s.grade}),t.jsx("div",{className:"text-sm sm:text-base text-gray-600 dark:text-gray-300",children:"grade"})]})]})}),t.jsxs(q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8",children:[t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 text-center",children:[t.jsx(o,{className:"w-8 h-8 text-yellow-500 mx-auto mb-2"}),t.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:F>=8?"Quiz Master!":F>=6?"Good Work!":"Keep Going!"})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 text-center",children:[t.jsx(c,{className:"w-8 h-8 text-blue-500 mx-auto mb-2"}),t.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:e>=80?"Sharpshooter":e>=60?"On Target":"Practice Makes Perfect"})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 text-center",children:[t.jsx(i,{className:"w-8 h-8 text-green-500 mx-auto mb-2"}),t.jsx("div",{className:"font-semibold text-gray-900 dark:text-white",children:"Quick & Focused"})]})]}),t.jsxs(q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},className:"bg-white dark:bg-gray-800 rounded-2xl p-4 sm:p-6 mb-8",children:[t.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"Detailed Review"}),t.jsx("div",{className:"space-y-6",children:Z.map((e,s)=>t.jsx(q.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.6+.1*s},className:"border border-gray-200 dark:border-gray-700 rounded-xl p-4 sm:p-6",children:t.jsxs("div",{className:"flex items-start space-x-4",children:[t.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center "+(e.isCorrect?"bg-green-100 dark:bg-green-900/30":e.timedOut?"bg-orange-100 dark:bg-orange-900/30":"bg-red-100 dark:bg-red-900/30"),children:e.isCorrect?t.jsx(x,{className:"w-5 h-5 text-green-600"}):e.timedOut?t.jsx(i,{className:"w-5 h-5 text-orange-600"}):t.jsx(m,{className:"w-5 h-5 text-red-600"})}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Question ",s+1]}),e.timedOut&&t.jsx("span",{className:"text-sm font-medium text-orange-600 dark:text-orange-400",children:"Time ran out"})]}),t.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-4",children:e.question.question_text}),t.jsx("div",{className:"space-y-2 mb-4",children:e.question.options.map(s=>{const a=s.id===e.selectedOptionId,r=s.id===e.question.correct_option_id;return t.jsx("div",{className:"p-3 rounded-lg border-2 "+(a&&r?"border-green-500 bg-green-50 dark:bg-green-900/20":a&&!r?"border-red-500 bg-red-50 dark:bg-red-900/20":r?"border-green-300 bg-green-50 dark:bg-green-900/10":"border-gray-200 dark:border-gray-600"),children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-1 sm:space-y-0",children:[t.jsx("span",{className:"text-gray-900 dark:text-white",children:s.text}),t.jsxs("div",{className:"flex space-x-2",children:[a&&t.jsx("span",{className:"text-xs sm:text-sm font-medium text-blue-600",children:"Your Answer"}),r&&t.jsx("span",{className:"text-xs sm:text-sm font-medium text-green-600",children:"Correct"})]})]})},s.id)})}),e.question.explanation&&t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[t.jsx("h4",{className:"font-semibold text-blue-900 dark:text-blue-100 mb-2",children:"Explanation"}),t.jsx("p",{className:"text-blue-800 dark:text-blue-200",children:e.question.explanation})]})]})]})},s))})]}),t.jsxs(q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.7},className:"flex flex-col sm:flex-row gap-4 justify-center",children:[t.jsxs("button",{onClick:Ne,className:"flex items-center justify-center space-x-2 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-xl transition-colors",children:[t.jsx(u,{className:"w-5 h-5"}),t.jsx("span",{children:"Try Again"})]}),t.jsx("button",{onClick:ve,className:"flex items-center justify-center space-x-2 bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-xl transition-colors",children:t.jsx("span",{children:"Back to Home"})}),e>=80&&t.jsxs("button",{onClick:()=>{navigator.share?navigator.share({title:"USMLE Quick Quiz Results",text:`Just scored ${F}/${$} (${e}%) on a USMLE Quick Quiz! ðŸŽ‰`,url:window.location.origin}):(navigator.clipboard.writeText(`Just scored ${F}/${$} (${e}%) on a USMLE Quick Quiz! ðŸŽ‰ Check it out at ${window.location.origin}`),alert("Results copied to clipboard!"))},className:"flex items-center justify-center space-x-2 bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white font-semibold py-3 px-6 rounded-xl transition-colors",children:[t.jsx(g,{className:"w-5 h-5"}),t.jsx("span",{children:"Share Success!"})]})]})]})})]})}const we=ne[D],ke=(D+1)/$*100;return t.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100 dark:from-gray-900 dark:via-purple-900/20 dark:to-indigo-900/20",children:t.jsx("div",{className:"container mx-auto px-4 py-8",children:t.jsxs("div",{className:"max-w-4xl mx-auto",children:[t.jsx(q.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"flex justify-center mb-6",children:t.jsxs("div",{className:`\n              relative inline-flex items-center justify-center p-6 rounded-full\n              ${te<=10?"bg-red-100 dark:bg-red-900/30":"bg-white dark:bg-gray-800"}\n              shadow-lg transition-all duration-300\n            `,children:[t.jsx("svg",{className:"absolute inset-0 w-full h-full -rotate-90",children:t.jsx("circle",{cx:"50%",cy:"50%",r:"45%",fill:"none",stroke:te<=10?"#ef4444":"#8b5cf6",strokeWidth:"4",strokeLinecap:"round",strokeDasharray:te/60*283+" 283",className:"transition-all duration-1000 ease-linear"})}),t.jsxs("div",{className:"relative z-10 text-center",children:[t.jsxs("div",{className:"text-3xl font-bold tabular-nums "+(te<=10?"text-red-600 animate-pulse":"text-gray-800 dark:text-white"),children:[Math.floor(te/60),":",(te%60).toString().padStart(2,"0")]}),t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:te<=10?"Hurry!":"Time Left"})]}),t.jsx(i,{className:"absolute top-2 right-2 w-4 h-4 "+(te<=10?"text-red-500":"text-purple-500")})]})},ae),t.jsx(C,{title:I,subtitle:`Question ${D+1} of ${$}`,onExit:ve,showTimer:!1}),t.jsx(k,{current:D+1,total:$,progress:ke}),t.jsx(S,{mode:"wait",children:t.jsx(q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:"mt-6",children:t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden",children:t.jsx(_,{currentQuestion:we,selectedOption:R,handleOptionSelect:e=>{if(null!==R||Y)return;B(e);const t=ne[D],s=e===t.correct_option_id;s&&G(e=>e+1);const a={questionIndex:D,question:t,selectedOptionId:e,isCorrect:s};V(e=>[...e,a]),H&&!ce&&(pe(a=>[...a,{session_id:H.id,question_id:t.id,selected_option_id:e,is_correct:s,response_order:D+1,time_spent_seconds:0}]),ye(e=>[...e,{user_id:r.id,question_id:t.id,last_answered_correctly:s,last_seen_at:(new Date).toISOString()}])),J(!0),setTimeout(()=>{D<ne.length-1?(U(D+1),B(null),J(!1),se(60),re(e=>e+1)):je()},500)},showExplanations:!1,isAnswered:null!==R})})},D)}),Y&&t.jsx(q.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"fixed bottom-8 left-1/2 transform -translate-x-1/2 z-50",children:t.jsxs("div",{className:"flex items-center space-x-3 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-full px-6 py-3 shadow-2xl",children:[t.jsx(q.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-5 h-5",children:t.jsx(i,{className:"w-5 h-5"})}),t.jsx("span",{className:"font-medium",children:D<ne.length-1?"Next question...":"Calculating results..."})]})})]})})})};export{z as default};
