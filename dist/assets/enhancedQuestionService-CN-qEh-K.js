import{s as e}from"./index-CwYISt8q.js";class t{static async getQuestionsForQuiz(t){const{categoryId:o,questionCount:s=10,difficulty:i=null,quizMode:n="quick"}=t;try{let t=e.from("questions").select("\n          id,\n          question_text,\n          options,\n          correct_option_id,\n          explanation,\n          difficulty,\n          points,\n          image_url,\n          question_tags!inner(\n            tags!inner(\n              id,\n              name,\n              type,\n              parent_id\n            )\n          )\n        ");if(o&&"mixed"!==o){const e=this.mapCategoryToTagType(o);t=t.eq("question_tags.tags.type",e),"all"!==o&&(t=t.ilike("question_tags.tags.name",`%${o}%`))}i&&"mixed"!==i&&(t=t.eq("difficulty",i.toLowerCase())),t=t.order("id",{ascending:!1}).limit(3*s);const{data:n,error:r}=await t;if(r)throw console.error("Error fetching questions:",r),r;return(n?.sort(()=>.5-Math.random())||[]).slice(0,s)}catch(r){throw console.error("Error in getQuestionsForQuiz:",r),r}}static async createQuizSession(t){const{userId:o,quizMode:s,categoryId:i,questionCount:n,difficulty:r,timerConfig:a,settings:c={}}=t;try{const t=this.mapQuizModeToSessionType(s);let r=null;i&&"mixed"!==i&&(r=await this.getCategoryTagId(i));const a={user_id:o,session_type:t,category_tag_id:r,total_questions:n,started_at:(new Date).toISOString()},{data:c,error:u}=await e.from("quiz_sessions").insert(a).select().single();if(u)throw console.error("Error creating quiz session:",u),u;return c}catch(u){throw console.error("Error creating quiz session:",u),u}}static async recordQuizResponses(t,o){try{const s=o.map((e,o)=>({session_id:t,question_id:e.questionId,selected_option_id:e.selectedOptionId,is_correct:e.isCorrect,time_spent_seconds:e.timeSpent||0,answered_at:e.answeredAt||(new Date).toISOString()})),{error:i}=await e.from("quiz_responses").insert(s);if(i)throw console.error("Error recording quiz responses:",i),i;return s}catch(s){throw console.error("Error recording quiz responses:",s),s}}static async completeQuizSession(t,o){const{correctAnswers:s,totalTimeSeconds:i,pointsEarned:n,userId:r}=o;try{const{error:o}=await e.from("quiz_sessions").update({completed_at:(new Date).toISOString(),correct_answers:s,total_time_seconds:i,points_earned:n}).eq("id",t).eq("user_id",r);if(o)throw console.error("Error completing quiz session:",o),o;return{success:!0}}catch(a){throw console.error("Error completing quiz session:",a),a}}static getQuizModeConfig(e){const t={quick:{questionCount:10,timePerQuestion:60,autoAdvance:!0,showExplanations:"end",sessionType:"self_paced",autoAdvanceDelay:.5},timed:{questionCount:20,totalTime:1800,autoAdvance:!1,showExplanations:"immediate",sessionType:"timed"},custom:{questionCount:null,timePerQuestion:60,autoAdvance:!1,showExplanations:"immediate",sessionType:"self_paced"},block:{questionCount:null,blocksCount:null,timePerQuestion:60,bonusTimePerBlock:300,autoAdvance:!1,showExplanations:"end",sessionType:"timed",pauseResume:!0},blitz:{questionCount:5,timePerQuestion:30,autoAdvance:!0,showExplanations:"end",sessionType:"self_paced",difficulty:"easy"}};return t[e]||t.quick}static mapQuizModeToSessionType(e){return{quick:"self_paced",timed:"timed",custom:"self_paced",block:"timed",learn:"learn_module"}[e]||"self_paced"}static mapCategoryToTagType(e){return{cardiology:"system",neurology:"system",endocrinology:"system",psychiatry:"system",anatomy:"subject",physiology:"subject",pathology:"subject",pharmacology:"subject"}[e]||"system"}static async getCategoryTagId(t){try{const{data:o,error:s}=await e.from("tags").select("id").ilike("name",`%${t}%`).limit(1).single();return s||!o?null:o.id}catch(o){return console.error("Error getting category tag ID:",o),null}}static async getAvailableCategories(){try{const{data:t,error:o}=await e.from("tags").select("\n          id,\n          name,\n          type,\n          parent_id,\n          question_tags(count)\n        ").order("name");if(o)throw console.error("Error fetching categories:",o),o;return t||[]}catch(t){throw console.error("Error fetching categories:",t),t}}static getDemoQuestions(e=10){const t=[{id:"demo-1",question_text:"Which of the following is the most common cause of myocardial infarction?",options:[{id:"a",text:"Coronary artery thrombosis"},{id:"b",text:"Coronary artery spasm"},{id:"c",text:"Aortic stenosis"},{id:"d",text:"Pulmonary embolism"}],correct_option_id:"a",explanation:"Coronary artery thrombosis is the most common cause of myocardial infarction, typically occurring due to plaque rupture.",difficulty:"medium",points:1,question_tags:[{tags:{name:"Cardiology",type:"system"}}]},{id:"demo-2",question_text:"The normal resting heart rate for a healthy adult is:",options:[{id:"a",text:"40-50 beats per minute"},{id:"b",text:"60-100 beats per minute"},{id:"c",text:"100-120 beats per minute"},{id:"d",text:"120-140 beats per minute"}],correct_option_id:"b",explanation:"The normal resting heart rate for healthy adults is 60-100 beats per minute.",difficulty:"easy",points:1,question_tags:[{tags:{name:"Physiology",type:"subject"}}]},{id:"demo-3",question_text:"Which hormone is primarily responsible for regulating blood glucose levels?",options:[{id:"a",text:"Cortisol"},{id:"b",text:"Insulin"},{id:"c",text:"Thyroxine"},{id:"d",text:"Growth hormone"}],correct_option_id:"b",explanation:"Insulin is the primary hormone responsible for regulating blood glucose levels by facilitating glucose uptake by cells.",difficulty:"medium",points:1,question_tags:[{tags:{name:"Endocrinology",type:"system"}}]}],o=[];for(;o.length<e;)o.push(...t);return o.slice(0,e).map((e,t)=>({...e,id:`demo-${t+1}`}))}}export{t as E};
