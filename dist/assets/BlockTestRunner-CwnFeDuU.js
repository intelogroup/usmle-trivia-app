import{r as e,j as s,m as t,A as n}from"./vendor-BncJ-8MG.js";import{d as i,e as a,g as o,p as r,h as l}from"./questionService-uvHltzaj.js";import"./index-DqWzw0jf.js";const c=({show:e})=>e?s.jsx("div",{className:"absolute inset-0 pointer-events-none z-40 flex items-center justify-center",children:s.jsx("span",{role:"img","aria-label":"confetti",className:"text-5xl animate-bounce",children:"🎉"})}):null,d=["🅰️","🅱️","🇨","🇩"],u=({questions:i,onAnswer:a,onBlockComplete:o,answers:r,paused:l,refs:u})=>{const[x,m]=e.useState(0),[b,p]=e.useState(null),[h,f]=e.useState(!1),[j,g]=e.useState(!1),v=e.useRef([]);if(e.useEffect(()=>{h||v.current[0]?.focus()},[h,x]),!i||0===i.length)return s.jsx("div",{children:"No questions in this block."});const y=i[x];return s.jsxs(t.div,{className:"bg-white rounded-xl shadow p-4 relative",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[s.jsx(c,{show:j}),s.jsxs("div",{className:"mb-2 font-semibold",children:["Question ",x+1," / ",i.length]}),s.jsx("div",{className:"mb-4 text-lg font-medium",children:y.question_text}),s.jsx("div",{className:"space-y-2 mb-4",children:y.options&&y.options.map((e,n)=>s.jsxs(t.button,{ref:e=>{v.current[n]=e,u&&(u.current[n]=e)},className:`w-full flex items-center gap-3 text-left p-3 rounded-xl border transition-all font-semibold text-base focus:outline-none focus:ring-2 focus:ring-blue-400 ${b===e.id?e.id===y.correct_option_id?"bg-green-100 border-green-400 scale-105":"bg-red-100 border-red-400 shake":"border-gray-200 hover:bg-blue-50"} ${h?"pointer-events-none":""}`,disabled:h||l,onClick:()=>(e=>{if(h||l)return;p(e),f(!0);const s=e===y.correct_option_id;s&&g(!0),a(y.id,{selectedOptionId:e,isCorrect:s,responseOrder:x+1}),setTimeout(()=>g(!1),1200)})(e.id),"aria-pressed":b===e.id,tabIndex:0,children:[s.jsx("span",{className:"text-2xl",children:d[n]||"🔘"}),s.jsx("span",{children:e.text})]},e.id))}),s.jsx(n,{children:h&&s.jsxs(t.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,y:-12},className:"mb-2",children:[b===y.correct_option_id?s.jsx("div",{className:"text-green-700 font-semibold",children:"Correct!"}):s.jsxs("div",{className:"text-red-700 font-semibold",children:["Incorrect. Correct answer: ",s.jsx("b",{children:y.options.find(e=>e.id===y.correct_option_id)?.text})]}),y.explanation&&s.jsx("div",{className:"mt-2 text-sm text-gray-600 bg-gray-50 rounded p-2",children:y.explanation}),s.jsx("button",{className:"mt-4 w-full bg-blue-600 text-white py-2 rounded-xl font-semibold text-lg shadow-lg hover:bg-blue-700 transition",onClick:()=>{p(null),f(!1),x<i.length-1?m(e=>e+1):o()},"data-next-btn":!0,children:x<i.length-1?"Next Question":"Finish Block"})]})})]})},x=({session:t,onComplete:n})=>{const{numBlocks:c,questionsPerBlock:d,difficulty:x}=t.settings||{},[m,b]=e.useState(0),[p,h]=e.useState([]),[f,j]=e.useState([]),[g,v]=e.useState(!0),[y,w]=e.useState(!1),[N,k]=e.useState(60*d+300),[S,_]=e.useState(null),[q,C]=e.useState(null),[I,B]=e.useState([]);e.useEffect(()=>{v(!0),i({userId:t.user_id,blockIndex:m,questionsPerBlock:d,difficulty:x}).then(e=>h(e)).catch(e=>C(e.message||"Failed to load questions")).finally(()=>v(!1))},[m,t.user_id,d,x]),e.useEffect(()=>{if(y||g)return;const e=setInterval(()=>{k(s=>s<=1?(clearInterval(e),A(),0):s-1)},1e3);return _(e),()=>clearInterval(e)},[y,g]);const A=e.useCallback(async()=>{B(e=>[...e,...f]),m<c-1?(b(e=>e+1),j([]),k(60*d+300)):(await a(t.id),n({answers:[...I,...f],session:t}))},[f,m,c,d,t,I,n]);return g?s.jsx("div",{children:"Loading block questions..."}):q?s.jsx("div",{className:"text-red-600",children:q}):s.jsxs("div",{className:"max-w-2xl mx-auto p-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("div",{children:["Block ",m+1," / ",c]}),s.jsxs("div",{children:["Time Left: ",Math.floor(N/60),":",(N%60).toString().padStart(2,"0")]}),s.jsx("button",{onClick:y?async()=>{w(!1),await o(t.id)}:async()=>{w(!0),S&&clearInterval(S),await r(t.id,{currentBlock:m,timer:N,blockAnswers:f})},className:"ml-2 px-3 py-1 bg-gray-200 rounded",children:y?"Resume":"Pause"})]}),s.jsx(u,{questions:p,onAnswer:async(e,s)=>{await l(t.id,s,m),j(t=>[...t,{...s,questionId:e,block:m}])},onBlockComplete:A,answers:f,paused:y})]})};export{x as default};
