import{r as e,j as s,m as t,A as a,aN as r,aO as l,aP as i,aQ as n,aR as c,aS as o,aT as d}from"./vendor-CVvCghmu.js";const x=["#06b6d4","#f59e42","#10b981","#f43f5e","#6366f1","#eab308"];const m=({answers:e,session:t})=>{const a=t?.settings?.numBlocks||1;return s.jsxs("div",{className:"mb-6",children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Per-Block Breakdown"}),s.jsx("div",{className:"space-y-2",children:Array.from({length:a}).map((t,a)=>{const r=e.filter(e=>e.block===a),l=r.filter(e=>e.isCorrect).length;return s.jsxs("div",{className:"mb-1",children:[s.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[s.jsxs("span",{children:["Block ",a+1]}),s.jsxs("span",{children:[l," / ",r.length," correct"]})]}),s.jsx("div",{className:"w-full bg-gray-100 rounded h-2",children:s.jsx("div",{className:"bg-green-500 h-2 rounded",style:{width:l/(r.length||1)*100+"%"}})})]},a)})})]})},h=({answers:e})=>s.jsxs("div",{className:"mt-4 text-left",children:[s.jsx("h4",{className:"font-semibold mb-2",children:"Review Answers"}),s.jsx("div",{className:"space-y-2",children:e.map((e,t)=>s.jsxs("div",{className:"p-2 rounded bg-gray-50 border flex flex-col md:flex-row md:items-center gap-2",children:[s.jsxs("span",{className:"font-bold",children:["Q",t+1,":"]}),s.jsx("span",{className:"flex-1",children:e.questionText||e.question_text}),s.jsx("span",{className:e.isCorrect?"text-green-600":"text-red-600",children:e.isCorrect?"✔️":"❌"})]},t))})]}),f=({results:f,onRestart:b})=>{const{answers:g,session:j}=f||{},p=g?.length||0,u=g?.filter(e=>e.isCorrect).length||0,[y,v]=e.useState(0),[N,w]=e.useState(!1);e.useEffect(()=>{let e=0;const s=setInterval(()=>{e++,v(Math.min(e,u)),e>=u&&clearInterval(s)},20);return()=>clearInterval(s)},[u]);const k=function(e){let s=0,t=0,a=0,r=0;return e.forEach(e=>{e.isCorrect?(a++,s=Math.max(s,a),r=0):(r++,t=Math.max(t,r),a=0)}),{maxCorrect:s,maxWrong:t}}(g),C=function(e){const s={};return e.forEach(e=>{const t=e.topic||e.system||e.subject||"Other";s[t]||(s[t]={topic:t,correct:0,total:0}),s[t].total++,e.isCorrect&&s[t].correct++}),Object.values(s)}(g),S=function(e){return e.map((e,s)=>({q:s+1,time:e.timeSpent||0,correct:e.isCorrect}))}(g);return s.jsxs(t.div,{className:"max-w-lg mx-auto p-6 bg-white rounded-xl shadow-lg text-center",initial:{opacity:0,y:24},animate:{opacity:1,y:0},children:[s.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Block Test Complete!"}),s.jsxs("div",{className:"mb-4 text-3xl font-extrabold text-green-600",children:[s.jsx(a,{children:s.jsx(t.span,{initial:{scale:.7},animate:{scale:1},transition:{type:"spring",stiffness:300},children:y},y)}),s.jsxs("span",{className:"text-gray-700 font-normal text-xl",children:[" / ",p]})]}),s.jsx(m,{answers:g,session:j}),s.jsxs(t.div,{initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{delay:.2},className:"w-full bg-white dark:bg-gray-800 rounded-2xl p-4 mb-6 shadow text-left",children:[s.jsx("h3",{className:"text-lg font-bold mb-2",children:"Performance Analytics"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-semibold mb-1",children:"Per-topic Breakdown"}),s.jsx(r,{width:"100%",height:120,children:s.jsxs(l,{data:C,margin:{left:-20,right:10},children:[s.jsx(i,{dataKey:"topic",fontSize:12,tick:{fill:"#64748b"},interval:0,angle:-15,dy:10}),s.jsx(n,{allowDecimals:!1,fontSize:12,tick:{fill:"#64748b"}}),s.jsx(c,{formatter:(e,s)=>"correct"===s?`${e} correct`:e}),s.jsx(o,{dataKey:"correct",fill:"#06b6d4",children:C.map((e,t)=>s.jsx(d,{fill:x[t%x.length]},e.topic))})]})})]}),s.jsxs("div",{children:[s.jsx("div",{className:"font-semibold mb-1",children:"Time per Question (s)"}),s.jsx(r,{width:"100%",height:120,children:s.jsxs(l,{data:S,margin:{left:-20,right:10},children:[s.jsx(i,{dataKey:"q",fontSize:12,tick:{fill:"#64748b"}}),s.jsx(n,{allowDecimals:!1,fontSize:12,tick:{fill:"#64748b"}}),s.jsx(c,{formatter:e=>`${e}s`}),s.jsx(o,{dataKey:"time",fill:"#6366f1",children:S.map((e,t)=>s.jsx(d,{fill:e.correct?"#10b981":"#f43f5e"},e.q))})]})})]})]}),s.jsxs("div",{className:"flex flex-wrap gap-6 mt-4",children:[s.jsxs("div",{className:"bg-cyan-50 dark:bg-cyan-900/20 rounded-xl px-4 py-2 font-semibold",children:["Longest Correct Streak: ",s.jsx("span",{className:"text-green-600",children:k.maxCorrect})]}),s.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-xl px-4 py-2 font-semibold",children:["Longest Incorrect Streak: ",s.jsx("span",{className:"text-red-600",children:k.maxWrong})]})]})]}),s.jsxs("div",{className:"flex gap-2 justify-center mb-4",children:[s.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition",onClick:b,children:"Restart"}),s.jsx("button",{className:"px-4 py-2 bg-gray-200 text-gray-800 rounded-xl font-semibold hover:bg-gray-300 transition",onClick:()=>{const e=`I scored ${u}/${p} on USMLE Block Test!`;navigator.clipboard.writeText(e),alert("Score copied to clipboard!")},children:"Share"}),s.jsx("button",{className:"px-4 py-2 bg-gray-100 text-gray-800 rounded-xl font-semibold hover:bg-gray-200 transition",onClick:()=>w(e=>!e),children:N?"Hide":"Review"})]}),s.jsx(a,{children:N&&s.jsx(h,{answers:g})})]})};export{f as default};
